# Phase 1.11: Responsive Layout Guide

**Goal**: Create scaling system to adapt UI from 1280x720 base to larger resolutions while maintaining aspect ratio and readability

**Success Criteria**:
- responsive_layout.gd autoload created
- Scaling algorithm works for 1280x720 → 1920x1080, 2560x1440, 3840x2160
- Font sizes scale proportionally
- UI elements scale proportionally
- 16:9 aspect ratio maintained
- Easy to apply to any scene

**Prerequisites**:
- Phase 1.1 (Project Setup) - Base resolution configured
- Phase 1.10 (Default Theme) - Base font sizes defined

---

## Overview

Establishes the responsive scaling system that adapts the game's UI from the 1280x720 base resolution to larger displays. This system ensures text remains readable and UI elements maintain proper proportions across different screen sizes.

### Key Design Principles

- **Base-First Design**: All UI designed for 1280x720, then scaled up
- **Proportional Scaling**: Everything scales by the same factor (maintains layout)
- **Aspect Ratio Lock**: 16:9 maintained via `window/stretch/aspect="keep"`
- **Simple Implementation**: Single function call per scene: `ResponsiveLayout.apply_to_scene(self)`
- **Performance**: Scaling calculated once on scene load, not per-frame

---

## Implementation Tasks

### 1. Create Responsive Layout Autoload

**File**: `res://responsive_layout.gd`

**Basic Structure**:

```gdscript
extends Node

# Base resolution (design target)
const BASE_WIDTH: int = 1280
const BASE_HEIGHT: int = 720

# Minimum supported resolution (safeguard)
const MIN_WIDTH: int = 1280
const MIN_HEIGHT: int = 720

# Current scale factor (cached)
var current_scale: float = 1.0

func _ready():
	calculate_scale()

func calculate_scale() -> float:
	var viewport = get_viewport()
	if not viewport:
		return 1.0

	var viewport_size = viewport.get_visible_rect().size

	# Calculate scale based on smaller dimension (maintains aspect ratio)
	var scale_x = viewport_size.x / float(BASE_WIDTH)
	var scale_y = viewport_size.y / float(BASE_HEIGHT)
	current_scale = min(scale_x, scale_y)

	return current_scale

func get_scale() -> float:
	return current_scale

func get_scaled_font_size(base_size: int) -> int:
	return int(base_size * current_scale)

func apply_to_scene(scene_root: Node) -> void:
	"""
	Apply responsive scaling to a scene.
	Call this from scene's _ready() function:

	func _ready():
		ResponsiveLayout.apply_to_scene(self)
	"""
	calculate_scale()

	# Note: With window/stretch/aspect="keep" in project.godot,
	# Godot handles most scaling automatically. This function
	# is mainly for manual font size adjustments if needed.

	# Future: Can add logic here to scale specific elements
	# that don't scale well with default stretch mode

func get_scaled_value(base_value: float) -> float:
	"""
	Scale any numeric value (margins, spacing, etc.)
	"""
	return base_value * current_scale
```

### 2. Register Autoload

Add to [project.godot](../project.godot):

```ini
[autoload]

ResponsiveLayout="*res://responsive_layout.gd"
```

### 3. Usage Pattern in Scenes

**In any scene's script:**

```gdscript
extends Control

func _ready():
	# Apply responsive scaling
	ResponsiveLayout.apply_to_scene(self)

	# Example: Manually scale a font if needed
	# (Usually not needed - theme handles this)
	if some_label:
		var base_font_size = 16
		some_label.add_theme_font_size_override(
			"font_size",
			ResponsiveLayout.get_scaled_font_size(base_font_size)
		)
```

### 4. Scaling Strategy

**What Scales Automatically**:
- Window size (via `window/stretch/mode="canvas_items"`)
- Aspect ratio (via `window/stretch/aspect="keep"`)
- All Control nodes and their children
- UI positioning and spacing

**What May Need Manual Scaling**:
- Custom font size overrides (use `get_scaled_font_size()`)
- Dynamically created UI elements (use `get_scaled_value()`)
- Particle sizes or other effects (if resolution-dependent)

**Common Scaling Scenarios**:

| Base Resolution | Scale Factor | Resulting Resolution | Example |
|----------------|--------------|---------------------|---------|
| 1280x720 | 1.0x | 1280x720 | Base size |
| 1280x720 | 1.5x | 1920x1080 | Full HD (150%) |
| 1280x720 | 2.0x | 2560x1440 | 2K (200%) |
| 1280x720 | 3.0x | 3840x2160 | 4K (300%) |

---

## Testing Strategy

### Manual Test Criteria

**Autoload Verification:**
- [ ] responsive_layout.gd created
- [ ] Registered in project.godot autoloads
- [ ] No errors on project launch

**Scaling Tests:**

Test at each resolution:

**1280x720 (100% - Base)**:
- [ ] Font size 16px is readable
- [ ] UI elements properly spaced
- [ ] No UI clipping or overflow

**1920x1080 (150% scale)**:
- [ ] Font size scales to 24px (16 × 1.5)
- [ ] UI elements scale proportionally
- [ ] Text remains sharp and readable
- [ ] No pixelation or blurriness

**2560x1440 (200% scale)**:
- [ ] Font size scales to 32px (16 × 2.0)
- [ ] Large text remains readable (not too big)
- [ ] UI elements maintain proportions

**3840x2160 (300% scale - 4K)**:
- [ ] Font size scales to 48px (16 × 3.0)
- [ ] All UI elements visible and proportional
- [ ] Performance remains stable

**Window Resize Test:**
- [ ] Resize window from small to large
- [ ] 16:9 aspect ratio maintained (black bars if needed)
- [ ] No UI distortion or stretching

**Fullscreen Toggle:**
- [ ] F11 toggles fullscreen
- [ ] Scaling adjusts correctly
- [ ] UI remains properly proportioned

---

## Files to Create

- `res://responsive_layout.gd` - Responsive layout autoload

## Files to Modify

- `project.godot` - Add ResponsiveLayout to autoloads:
  ```ini
  [autoload]
  ResponsiveLayout="*res://responsive_layout.gd"
  ```

---

## Design Values (Reference)

### Scaling Algorithm

**Formula**:
```
scale_factor = min(window_width / 1280, window_height / 720)
```

**Why `min()`?**
- Ensures content fits within window
- Maintains 16:9 aspect ratio
- Prevents UI from being cut off

**Example**:
- Window: 1920×1080
- scale_x = 1920 / 1280 = 1.5
- scale_y = 1080 / 720 = 1.5
- scale_factor = min(1.5, 1.5) = **1.5x**

**Example 2 (ultra-wide)**:
- Window: 2560×1080 (21:9 ultra-wide)
- scale_x = 2560 / 1280 = 2.0
- scale_y = 1080 / 720 = 1.5
- scale_factor = min(2.0, 1.5) = **1.5x** (limited by height)
- Result: Black bars on sides (maintains 16:9)

### Base Design Values (1280x720)

All UI elements should be designed assuming 1280x720 resolution:

- **Button min width**: 120px → 180px @ 1080p, 240px @ 1440p
- **Panel padding**: 10px → 15px @ 1080p, 20px @ 1440p
- **Icon size**: 32px → 48px @ 1080p, 64px @ 1440p
- **Spacing between elements**: 8px → 12px @ 1080p, 16px @ 1440p

---

## Phase Status

**Status**: Ready for Implementation

**Estimated Time**: 1.5 hours
- 30 min: Create responsive_layout.gd autoload
- 30 min: Implement scaling functions
- 30 min: Test across multiple resolutions

**Dependencies Complete**:
- Phase 1.1 (Project Setup) ✓
- Phase 1.10 (Default Theme) ✓

**Previous Phase**: [1.10-default-theme.md](1.10-default-theme.md)

**Next Phase**: [1.12-audio-system.md](1.12-audio-system.md) (if exists)

---

## Notes & Decisions

**Decision 1**: Use `window/stretch/aspect="keep"` instead of `expand`
- **Rationale**: Maintains 16:9 aspect ratio, prevents UI distortion
- **Trade-off**: May show black bars on non-16:9 displays (acceptable)
- **Alternative**: `expand` stretches to fill, but distorts UI on ultra-wide

**Decision 2**: Base resolution 1280x720
- **Rationale**: Standard HD, comfortable size, easy to scale (1.5x→1080p, 2x→1440p, 3x→4K)
- **Benefit**: All scaling factors are clean multiples (no fractional scales)

**Decision 3**: Autoload pattern for scaling
- **Rationale**: Global access, consistent scaling across all scenes
- **Usage**: Single `ResponsiveLayout.apply_to_scene(self)` call per scene

**Decision 4**: Calculate scale once per scene load
- **Rationale**: Window size rarely changes during gameplay
- **Performance**: No per-frame calculations needed
- **Future**: Can add window resize listener if dynamic scaling needed

---

## Advanced Topics (Future Enhancements)

**Window Resize Handling**:
```gdscript
func _notification(what):
	if what == NOTIFICATION_WM_SIZE_CHANGED:
		ResponsiveLayout.calculate_scale()
		ResponsiveLayout.apply_to_scene(self)
```

**Custom Scaling for Specific Elements**:
```gdscript
func apply_custom_scaling():
	var scale = ResponsiveLayout.get_scale()

	# Example: Scale notification panel differently
	notification_panel.custom_minimum_size = Vector2(
		300 * scale,
		60 * scale
	)
```

**DPI Scaling** (for very high DPI displays):
```gdscript
func get_dpi_scale() -> float:
	var screen_dpi = DisplayServer.screen_get_dpi()
	var base_dpi = 96.0  # Standard DPI
	return screen_dpi / base_dpi
```

---

## Implementation Checklist

Before marking this phase complete:

- [ ] responsive_layout.gd created
- [ ] Autoload registered in project.godot
- [ ] `calculate_scale()` function implemented
- [ ] `get_scaled_font_size()` function implemented
- [ ] `get_scaled_value()` function implemented
- [ ] `apply_to_scene()` function implemented
- [ ] Test scene created to verify scaling
- [ ] Scaling verified at 1280x720 (100%)
- [ ] Scaling verified at 1920x1080 (150%)
- [ ] Scaling verified at 2560x1440 (200%)
- [ ] Scaling verified at 3840x2160 (300%)
- [ ] Window resize maintains aspect ratio
- [ ] Fullscreen toggle works correctly
- [ ] Documentation added for usage pattern

---

**Last Updated**: 2025-11-28
**Maintainer**: Claude + User collaboration
