# Phase 2.6: Content, Balance & Silver Era Transition

**Goal**: Polish, balance, full content suite, and implement Silver Era gate.

**Success Criteria**: Full Copper Era playable, balanced, can reach Silver Era

**Prerequisites**: Phases 2.1-2.5 complete

---

## Implementation Tasks

### 1. Complete Technique Suite

Expand `res://data/techniques.gd` to 40+ techniques:

**Total: 40 techniques** (8 Emotional + 9 Mental + 15 Proprioceptive + 8 Mixed/Special)

#### Emotional (Insight + Passion) - 8 techniques
- Inner Peace (Rare): Focus drains 20% slower
- Acceptance (Common): -15% lactic acid buildup
- Determination (Rare): Stamina drains 15% slower
- Grit (Epic): Can work 10 seconds at 0 stamina before collapse
- Zen (Legendary): Focus doesn't drain during demand events
- Hope (Common): +10% stamina recovery during breaks
- Defiance (Rare): +20% pay when overseer mood < 30
- Composure (Rare): Spill chance doesn't increase during shakes

#### Mental (Insight + Experience) - 9 techniques
- Pattern Recognition (Rare): See shake warnings 1s earlier
- Rhythm (Common): +10% stamina if consistent pace
- Risk Assessment (Epic): See demand event multiplier value
- Focus (Common): -15% focus cost for shopping
- Meditation (Rare): +0.8 stamina per second during breaks (vs 0.5)
- Foresight (Epic): See next break coal count 10 coal in advance
- Calculation (Rare): See overseer mood value (normally hidden)
- Observation (Common): See technique rarity chances
- Memory (Rare): Reroll costs 5c instead of 10c

#### Proprioceptive (Experience + Drive) - 15 techniques
- Balance (Common): -15% spill chance
- Precision (Rare): Coal placement counts at 1.5x distance
- Economy of Motion (Rare): -12% stamina per shovel
- Steady Hands (Common): Lactic acid buildup 25% slower
- Fast Twitch (Rare): Can drag 20% faster without spill penalty
- Endurance (Epic): Max stamina +25%
- Strength (Common): Stamina per shovel -8%
- Coordination (Rare): Can carry +1 coal without shovel upgrade
- Reflexes (Rare): 0.5s reaction time to avoid shakes (click to brace)
- Stability (Common): -20% shake spill penalty
- **Zone Out (Rare)**: +35% auto-shovel chance after manual shovels
- **Muscle Memory (Rare)**: Auto-shovels cost 40% stamina (vs 75%)
- **Efficient Motion (Common)**: Auto-shovels 20% faster animation
- **Perfect Form (Epic)**: Auto-shovels have 75% reduced spill chance (vs 50%)
- **Autopilot (Legendary)**: Auto-shovels never spill, cost 25% stamina

#### Mixed/Special - 8 techniques
- **Flow State (Epic)**: Auto-shovels can chain (30% chance to trigger another)
- **Trance (Legendary)**: Zone-out chance applies twice per manual shovel (double rolls)
- **Momentum (Rare)**: Each consecutive auto-shovel increases next auto-shovel chance by 5% (stacks)
- **Meditation (Epic)**: Auto-shovels restore 2 focus instead of consuming it
- Desperation (Epic): +50% stamina efficiency when stamina < 20%
- Pride (Rare): +15% pay if no spills entire shift
- Spite (Rare): Each spill grants +5% stamina for 30s (anger fuel)
- Resilience (Epic): Retain 75% techniques when skipping rations (vs 50%)

#### Example Build Archetypes

**Zone-Out Specialist** (High automation):
- Zone Out (Rare): +35% auto-shovel chance
- Muscle Memory (Rare): Auto-shovels cost 40% stamina
- Flow State (Epic): Auto-shovels chain at 30%
- Perfect Form (Epic): Auto-shovels rarely spill
- Result: 60-80% auto-shovel chance, efficient chains, minimal player input

**Endurance Grinder** (Long shifts):
- Determination (Rare): Stamina drains 15% slower
- Endurance (Epic): Max stamina +25%
- Economy of Motion (Rare): -12% stamina per shovel
- Meditation (Epic): Auto-shovels restore focus
- Result: Can work extremely long shifts, sustainable pace

**Perfect Precision** (High risk, high reward):
- Autopilot (Legendary): Perfect auto-shovels
- Pride (Rare): +15% pay if no spills
- Precision (Rare): Better coal placement
- Fast Twitch (Rare): Faster dragging
- Result: Perfect runs with high pay multipliers

**Hybrid Momentum** (Snowball effect):
- Zone Out (Rare): +35% auto-shovel
- Momentum (Rare): Stacking auto-shovel bonuses
- Trance (Legendary): Double zone-out rolls
- Flow State (Epic): Chain auto-shovels
- Result: Starts slow, becomes unstoppable

**Zone-Out Synergy with Permanent Progression**:
- Early game (500-1000 reps): Techniques carry the load (Zone Out technique = huge boost)
- Mid game (2000-5000 reps): Permanent + technique = reliable automation
- Late game (10000+ reps): 45% permanent + 35% technique + chain/trance = constant auto-shoveling

---

### 2. Balance Tuning Pass

Run 50+ simulated days, adjust:
- Equipment costs (ensure smooth progression curve)
- Technique rarity distribution
- Overseer bias weights (ensure 1-3c Day 1, 50-100c Week 4)
- Purse upgrade pacing (should gate around Days 8, 15, 25, 35, 50)
- Consumable effectiveness
- Demand event frequency/duration
- Break penalty severity

#### Target Progression Curve
- Day 1: 1-3c
- Day 5: 5-8c (can afford first permanent upgrade)
- Day 10: 12-18c
- Day 15: 25-35c (2nd purse upgrade)
- Day 20: 40-60c
- Day 30: 70-100c
- Day 40: 120-180c
- Day 50+: 150-250c (grinding toward 2000c total)

---

### 3. Silver Era Transition Gate

Create `res://level1/overseer_office.tscn`:
- Available in evening after requirements met
- Requirements:
  1. Total bribes spent >= 1000c
  2. Current copper >= 1000c (to buy silver coin)
  3. Purse capacity >= 1400c (can hold silver coin)

#### Transition Scene
- Overseer offers promotion to Silver Era
- Pay 1 silver coin (costs 1000c via currency conversion)
- Narrative: "You've proven yourself. Welcome to management."
- Unlock morning furnace selection -> overseer shift selection
- **Not implemented in Phase 2.6**: Silver Era gameplay (future expansion)
- For now: Victory screen congratulating player, stats summary

---

### 4. Additional Furnaces

Expand to 5 total furnaces:
1. Training Furnace (always available)
2. East Wing Furnace (50 lifetime coal)
3. Boiler Room (200 lifetime coal)
4. Engine Room (500 lifetime coal, 0.12 copper/coal, harsh overseer)
5. Freight Furnace (1000 lifetime coal, 0.15 copper/coal, very demanding)

Each furnace has unique:
- Distance from coal pile (stamina per trip)
- Base pay rate
- Overseer personality (bias weights)
- Shake frequency
- Visual theme (lighting, temperature effects)

---

### 5. Polish & Juice

#### Visual Effects
- Coal particle effects when shoveling
- Sweat drops when stamina low
- Screen edge vignette when focus low
- Overseer portrait expressions based on mood
- Furnace glow intensity based on coal fed
- Screen shake intensifies during demand events
- Technique activation visual (brief flash/overlay)

#### Audio (If Time Permits)
- Shovel scrape sound (pitch varies with fatigue)
- Coal clatter into furnace
- Furnace roar ambient
- Whistle sound for breaks
- Overseer voice barks during demand events
- Coin clink on payment

#### UI Polish
- Smooth transitions between phases
- Loading screen when changing scenes
- Stat increase animations
- Payment reveal animation (slot machine style?)
- Technique card hover effects
- Button hover states (use default_theme.tres)

---

### 6. Balance Validation Tests

Create `tests/test_economy_balance.gd`:
- Simulate 100 days with average play
- Verify median earnings per day match target curve
- Ensure 2000c achievable in 40-60 days
- Check purse upgrades gate at expected days
- Validate technique slot purchases affordable
- Confirm no soft-lock scenarios (always can earn at least 1c)

```gdscript
# Simulate 100 days, verify progression curve
func test_100_day_simulation():
    var earnings_by_day = []
    for day in range(100):
        var earnings = simulate_average_day(day)
        earnings_by_day.append(earnings)

    # Check key milestones
    assert_true(earnings_by_day[0] >= 1 and earnings_by_day[0] <= 3)  # Day 1
    assert_true(earnings_by_day[9] >= 12 and earnings_by_day[9] <= 18)  # Day 10
    assert_true(earnings_by_day[29] >= 70 and earnings_by_day[29] <= 100)  # Day 30

    # Check 2000c achievable
    var total_copper = 0
    for earning in earnings_by_day:
        total_copper += earning
        if total_copper >= 2000:
            assert_true(day >= 40 and day <= 60)  # Should hit between Day 40-60
            break
```

---

### 7. Documentation Update

#### Update `.claude/docs/game-systems.md`
- Document roguelite systems (techniques, internal resources)
- Document overseer bias calculations (for maintainers)
- Document ration choice mechanic
- Update stat system section with Constitution/Wisdom XP

#### Create `.claude/docs/roguelite-systems.md`
- Comprehensive guide to technique system
- Internal resource earning
- Run state vs. persistent state
- Ration choice discovery
- Overseer bias formulas
- Silver Era requirements

---

### 8. Save System Integration

Extend save/load:
- **Persistent**: Stats, equipment, copper, purse, bribes spent, furnaces unlocked, technique slots, lifetime coal
- **Run state**: Stamina, focus, coal count, techniques active, internal resources
- Clear run state on day start, preserve persistent state

#### Save Schema
```json
{
    "version": "2.0",
    "persistent": {
        "stats": {...},
        "equipment": {...},
        "copper": 0,
        "total_bribes_spent": 0,
        "lifetime_coal_shoveled": 0,
        "unlocked_furnaces": [],
        "technique_slots": 2
    },
    "current_run": {
        "day_number": 1,
        "selected_furnace": "Training Furnace",
        "techniques_active": [],
        "internal_resources": {...}
    }
}
```

---

## TDD Requirements (Headless Tests)

Create `tests/test_phase_2_6.gd`:

```gdscript
# Test: Silver Era requirements
func test_silver_era_gate():
    Global.total_bribes_spent = 1000
    Global.copper = 1000
    EquipmentManager.equipment.purse = "lockbox"  # 1400 cap
    var can_transition = check_silver_era_requirements()
    assert_true(can_transition)

# Test: Economy balance - Day 1 earnings
func test_day_1_earnings_range():
    var earnings = simulate_average_day_1()
    assert_true(earnings >= 1 and earnings <= 3)

# Test: Economy balance - Week 4 earnings
func test_week_4_earnings_range():
    simulate_days(28)
    var earnings = simulate_average_shift()
    assert_true(earnings >= 50 and earnings <= 100)

# Test: Purse gates progression
func test_purse_gating():
    Global.copper = 300
    EquipmentManager.equipment.purse = "small_pouch"  # 300 cap
    var can_earn = can_earn_copper(50)
    assert_false(can_earn)  # At cap

# Test: All techniques have valid effects
func test_all_techniques_valid():
    for technique in Techniques.TECHNIQUES:
        assert_true("effect" in technique)
        assert_true("rarity" in technique)
        assert_true("cost" in technique)

# Test: Save/load preserves persistent state
func test_save_load_persistence():
    Global.copper = 500
    Global.total_bribes_spent = 250
    save_game()
    Global.copper = 0  # Reset
    load_game()
    assert_eq(Global.copper, 500)
    assert_eq(Global.total_bribes_spent, 250)

# Test: Run state clears on day start
func test_run_state_clear():
    RunState.coal_count = 100
    RunState.stamina = 50
    start_new_day()
    assert_eq(RunState.coal_count, 0)
    assert_eq(RunState.stamina, calculate_max_stamina())
```

---

## Manual Test Criteria

- [ ] Play full progression (0 -> Silver Era transition)
- [ ] Verify all 40+ techniques appear and function
- [ ] Confirm all 5 furnaces unlock at expected times
- [ ] Test all equipment purchases, verify effects
- [ ] Purchase all purse upgrades, hit caps
- [ ] Spend 1000c on bribes, track total
- [ ] Reach 2000c total, transition to Silver Era
- [ ] Skip rations multiple times, verify detection
- [ ] Test all demand event types
- [ ] Verify all cognitive biases affect pay
- [ ] Confirm payment feels unpredictable but discoverable
- [ ] Polish pass: Visuals, audio, transitions smooth
- [ ] **Zone-Out Build Testing**:
  - [ ] Play run with Zone Out + Muscle Memory + Flow State
  - [ ] Verify auto-shovel chains feel satisfying
  - [ ] Test Trance (legendary) double-roll mechanic
  - [ ] Confirm Momentum stacking works correctly
  - [ ] Late game (10k+ reps): Verify near-constant automation
  - [ ] Autopilot (legendary) run: Perfect auto-shovels, no spills
  - [ ] Meditation technique: Confirm auto-shovels restore focus

---

## Files to Create

- `res://level1/overseer_office.gd/.tscn` (Silver Era gate)
- `res://tests/test_phase_2_6.gd`
- `res://tests/test_economy_balance.gd`
- `.claude/docs/roguelite-systems.md`
- `res://debug/debug_panel.gd/.tscn` (debug tools)

## Files to Modify

- `res://data/techniques.gd`: Expand to 30+ techniques
- `res://level1/furnace_work.gd`: Polish, visual effects
- `res://level1/evening.gd`: Add Silver Era transition access
- `global.gd`: Save/load schema update
- `.claude/docs/game-systems.md`: Document new systems

---

## Design Values (Reference)

### Silver Era Requirements
- 1000c total bribes spent
- 1000c current copper (to buy silver coin)
- 1400c purse capacity (lockbox)

### Furnaces (Complete Set)
1. Training: 0.05 c/coal (always)
2. East Wing: 0.07 c/coal (50 lifetime coal)
3. Boiler Room: 0.10 c/coal (200 lifetime coal)
4. Engine Room: 0.12 c/coal (500 lifetime coal)
5. Freight: 0.15 c/coal (1000 lifetime coal)

### Target Economy
- Day 1-5: 1-8c per day
- Day 10-20: 12-60c per day
- Day 30-50: 70-250c per day
- Total to Silver Era: ~2000c in 40-60 days

---

## Debug Tools

Create `res://debug/debug_panel.tscn`:
- Toggle visible with F12 key
- Display hidden values (overseer mood, bias multipliers, etc.)
- Quick actions (add copper, set stats, skip to day X)
- Technique pool viewer
- Internal resource editor
- Only available in debug builds

---

**Phase Status**: Ready for implementation
**Estimated Time**: 25-30 hours
**Previous Phase**: [2.5-discovery-mechanics.md](2.5-discovery-mechanics.md)

---

## Overall Success Criteria

**Copper Era Complete When**:
- 40-60 days to reach 2000 copper (average player)
- Oppressive, grimdark tone maintained throughout
- Discovery-driven gameplay (no hand-holding)
- Technique variety encourages experimentation
- Payment feels unpredictable but patterns emerge
- Silver Era transition feels earned and significant

---

## Next Steps After Phase 2.6

Once Copper Era is complete and balanced:
1. Create Phase 3 plan (Silver Era: Overseer gameplay)
2. Create Phase 4 plan (Gold Era: Furnace ownership)
3. Expand technique pool (50-100 total techniques)
4. Add more furnaces (10+ total across all eras)
5. Implement achievement system
6. Add meta-progression depth (prestige layers?)

---

**Total Estimated Development Time**: 60-100 hours across all 6 phases
**Last Updated**: 2025-11-26
