# Phase 5.2: Scenes & Navigation

**Part of:** Phase 5 - Own Furnace and Worker Management
**Status:** Planning
**Created:** 2025-11-25 (Split from phase-5-own-furnace.md)
**Dependencies:** Phase 5.1 (Core Systems)

## Purchase System

### Furnace Ownership Purchase

**Location:** Overseer's Office scene ([level1/overseers_office.tscn](level1/overseers_office.tscn))

**Button Properties:**
- Text: "Buy Furnace Ownership"
- Position: Right panel, below Overtime button
- Visibility: Requires `lifetimecoins >= 10000` (1 Gold lifetime)
- Cost: 1 Gold

**Purchase Flow:**
```gdscript
func _on_buy_furnace_button_pressed():
    var cost = 10000  # 1 Gold
    if Level1Vars.coins >= cost:
        # Confirmation popup
        show_confirmation_popup(
            "Purchase Furnace Ownership?",
            "You'll become a furnace owner. Cost: 1 Gold"
        )

func confirm_purchase():
    var cost = 10000  # 1 Gold
    Level1Vars.coins -= cost
    Level1Vars.furnace_owned = true

    # Track for prestige system
    UpgradeTypesConfig.track_equipment_purchase("furnace_ownership", cost)

    # Log purchase
    DebugLogger.log_shop_purchase("Furnace Ownership", cost, 1)

    # Show success notification
    show_notification("You are now the owner of your own furnace")

    # Transition to owned furnace
    Global.change_scene_with_check(get_tree(), "res://level1/owned_furnace.tscn")
```

**One-Time Purchase:**
- Cannot be reversed
- Button disappears after purchase
- Unlocks worker management systems
- Changes bar scene navigation

---

## Scene Architecture

### Current Furnace (furnace.tscn)

**Remains as-is for non-owners:**
- Worker perspective
- Overseer interaction
- Coal → Coins conversion

### New Owned Furnace (own_furnace.tscn)

**Purpose:** Manager/owner perspective with new mechanics

**Scene Structure:**
Inherit from scene_template.tscn and set background to own-furnace.jpg

**Left Panel:**
- Title: "Your Furnace - Manager's Station"
- **Heat Gauge** (ProgressBar)
  - Shows current_heat / max_heat
  - Color: Red/orange gradient
  - Label: "Heat: 45 / 100"
- **Steam Production Display** (Label)
  - Shows steam_production_rate_lbh
  - Format: "Production: 10 lb/h"
  - Color: White text
- **Demand Indicator** (Panel with RichTextLabel)
  - Shows current demand state and rate
  - Format: "Demand: gold per lb/h (MEDIUM)"
  - Color-coded: Dark Blue (ZERO) / Green (LOW) / Yellow (MEDIUM) / Orange (HIGH) / Red (CRITICAL)
  - Shows demand reason text below
- **Payment Progress Display** (Option 2 Format)
  - **Progress Bar:** Shows gold_progress (0.0 - 1.0)
    - Color: Gold/yellow gradient
    - Visual: [=====>--------------]
  - Updates in real-time
- **Steam Storage Gauge** (ProgressBar) *(visible only when storage purchased)*
  - Shows stored_steam_lbs / max_storage_lbs
  - Color: Cyan/blue gradient (distinct from production)
  - Label: "Storage: 180 / 500 lb"
  - Shows efficiency: "Efficiency: 80%" (subtle, small text)
  - **Hidden by default** - only shows when has_storage_system = true
- **Resource Display**
  - Gold coins (current_gold)
  - Coal (still used for shoveling)

**Right Panel Buttons:**
- **Shovel Coal** - Manager helps with shoveling (replaces old coal generation)
  - Costs stamina
  - Gives charisma XP and strength
  - Generates small amount of heat
  - Temporarily boosts worker morale/efficiency
- **To Dormitory** - Transitions to owned_dorm.tscn for worker management ⭐ NEW
- **Upgrade Furnace** - Opens furnace upgrade popup
- **Storage Controls** *(visible only when Tier 3+ storage purchased)*
  - Opens storage control popup with release buttons and auto-release settings
- **Take Break** - Returns to bar

**Center Area:**
- Could display animated elements (heat glow, steam pipes) in future

**Color Indicator** (subtle discovery mechanic):
- Small dot next to "Visit Dormitory" button
- **Green:** All workers healthy (< 55 fatigue, morale > 60, food > 25%)
- **Yellow:** Some concerns (workers 55-80 fatigue OR morale 40-60 OR food 10-25%)
- **Red:** Critical issues (any worker > 80 fatigue OR morale < 40 OR food < 10%)

### New Owned Dormitory (owned_dorm.tscn) ⭐

**Purpose:** Worker management hub - hire, manage, upgrade dormitory

**Scene Structure:**
Duplicate existing [level1/dorm.tscn](level1/dorm.tscn) → owned_dorm.tscn

**Visual Changes:**
- Shows actual beds in scene (empty vs occupied)
- Bed count increases as upgrades purchased (visual progression)
- Workers visible when idle/on break

**Panel 1 (Left in Landscape / Top in Portrait): Worker Roster**
- Title: "Worker Roster"
- **Scrollable list** of hired workers (up to 20)
- Each worker entry shows:
  - **Name** (e.g., "Thomas")
  - **Type** (Stoker/Fireman/Engineer)
  - **Quality descriptor** (e.g., "Steady Hand", "Skilled Worker")
  - **Current status**: Active / Idle / On Break
  - If on break: countdown timer ("Break: 3:45 remaining")
  - **Action buttons per worker:**
    - [Assign Active] - Send to work
    - [Set Idle] - Rest in dorm
    - [Send on Break] - 5min recovery break
    - [Fire] - Remove worker (confirmation required)

**Panel 2 (Right in Landscape / Bottom in Portrait): Status & Controls**

*Status Info Section (Top):*
- **Food Supply:** "Food: 47 units (Decent Meal quality)"
  - Warning color if low (< 15 units: orange, < 5 units: red)
- **Dormitory Capacity:** "Beds: 8 / 10 occupied"
- **Reputation Hint** (narrative only, no number):
  - High reputation (70+): "Workers speak well of this place"
  - Medium reputation (30-70): "Your reputation is mixed"
  - Low reputation (< 30): "Conditions here are poorly regarded"
- **Worker Status Indicator:** Color dot (discovery mechanic)
  - Green/Yellow/Red based on crew health
  - No explicit explanation - players discover meaning

*Action Buttons Section (Middle):*
- **[Hire Workers]** - Opens hiring pool dialog (shows 3-8 candidates)
- **[Send All on Break]** - Group break, enhanced recovery ⭐
  - Shows "Cooldown: 12:34" if recently used (15min cooldown)
- **[Buy Food]** - Opens food shop (5 quality tiers)
- **[Dormitory Upgrades]** - Opens upgrade menu
  - **Beds Tab:** Purchase bed expansions (7 tiers, 2 → 20 capacity)
  - **Amenities Tab:** Purchase quality-of-life upgrades (10 tiers)
- **[Return to Furnace]** - Goes back to owned_furnace.tscn

*Settings Section (Bottom):*
- **Auto-Break Policy:** Dropdown selector
  - Options: Never / Conservative / Balanced / Aggressive / Preventive
  - Applies to all workers (individual breaks only)

**Dialogs Opened from owned_dorm.tscn:**

**1. Hiring Pool Dialog**
- Shows 3-8 available candidates (based on reputation)
- Each candidate: Name, Type, Quality descriptor, Hire cost
- [Refresh Pool - 50 coins] button
- Cannot hire if no empty beds

**2. Food Shop Dialog**
- Shows current supply and quality
- Purchase options: 5 quality tiers (Stale Bread → Premium Provisions)
- Each tier: Cost per 10 units, purchase buttons (10/50/100 units)
- Auto-purchase settings: Enable toggle, tier selector, amount selector

**3. Dormitory Upgrades Dialog**
- **Beds Tab:** 7 tiers of bed expansions
  - Visual: Checkmarks for owned, locks for locked
  - Shows requirements (runtime hours, components/mechanisms)
- **Amenities Tab:** 10 tiers of quality-of-life upgrades
  - Each shows: Description, vague benefit (no numbers), cost, requirements
  - Players discover actual effects through experimentation

**Center Area:**
- Background: dormitory interior (reuse dorm.jpg or create owned_dorm.jpg)
- Visual representation of beds (scalable, shows occupancy)
- Could show workers as sprites when idle/on break (future enhancement)

### Bar Scene Navigation Updates

**File:** [level1/bar.gd](level1/bar.gd)

**Modified Functions:**

**1. Furnace Button:**
```gdscript
func _on_to_blackbore_furnace_button_pressed():
    var target_scene
    if Level1Vars.furnace_owned:
        target_scene = "res://level1/owned_furnace.tscn"
    else:
        target_scene = "res://level1/furnace.tscn"
    Global.change_scene_with_check(get_tree(), target_scene)
```

**Button Text Update:**
- Before: "To Blackbore Furnace"
- After: "To Your Furnace" (when owned)

**2. Dormitory Button:** ⭐ NEW
```gdscript
func _on_to_dorm_button_pressed():
    var target_scene
    if Level1Vars.furnace_owned:
        target_scene = "res://level1/owned_dorm.tscn"
    else:
        target_scene = "res://level1/dorm.tscn"
    Global.change_scene_with_check(get_tree(), target_scene)
```

**Button Text Update:**
- Before: "To Dormitory"
- After: "To Worker Quarters" or "To Your Dormitory" (when owned)

**Routing Logic:**
- Before furnace purchase: All scenes route to original worker-perspective scenes
- After furnace purchase: Bar routes to owned_furnace.tscn and owned_dorm.tscn
- Maintains narrative consistency (player is now the owner/manager)

---
