# Phase 5.5: Hired Overseer (Offline Progression)

**Part of:** Phase 5 - Own Furnace and Worker Management
**Status:** Planning
**Created:** 2025-11-25 (Split from phase-5-own-furnace.md)
**Dependencies:** Phase 5.1 (Core Systems), Phase 5.3 (Worker Management)

## Hired Overseer System (Offline Progression) ⭐

### System Overview

**Purpose:** Enable offline progression by hiring an overseer to manage the furnace while the player is away

**Design Philosophy:**
- **No offline progression by default** - Heat, steam, demand, and revenue only accumulate when actively playing
- **Paid management** - Overseer must be compensated from accumulated revenue
- **Efficiency penalties** - Overseer operates at reduced efficiency compared to active player
- **Limited shift duration** - Initially short shifts, upgradeable to longer absences
- **Three independent upgrade dimensions** - Quality, duration, and management style

**Thematic Role Reversal:**
- Player was a worker under an overseer in the initial furnace scene
- Now the player is the owner hiring an overseer to manage their furnace
- Creates narrative symmetry and progression

---

### Three Independent Upgrade Paths

The Hired Overseer system has three separate, independently upgradeable dimensions:

**1. Overseer Quality (Production Efficiency)**
- Determines how efficiently the overseer operates the furnace
- Higher tiers = better production during offline periods
- 6 tiers: Apprentice → Junior → Experienced → Senior → Master → Executive Manager

**2. Shift Duration (Time Away Limit)**
- Determines maximum hours the overseer can manage before requiring player return
- Longer shifts = more offline time possible
- 10 tiers: 1h → 2h → 4h → 8h → 12h → 18h → 24h → 36h → 48h → 72h

**3. Management Style (Comfort ←→ Efficiency)**
- Continuous slider controlling overseer's treatment of workers
- Affects production (hidden), cost (visible), and charisma gain (hidden)
- Player only sees cost differences, must discover optimal settings through experimentation

---

### 1. Overseer Quality Upgrades

Progressive efficiency tiers representing overseer skill and experience.

**Tier 1: Apprentice Overseer**
- **Efficiency:** 30% of full production
- **Cost:** 15 Silver
- **Requirements:** Furnace ownership
- **Description:** "Inexperienced manager, still learning the ropes. Keeps things running at minimal capacity."

**Tier 2: Junior Overseer**
- **Efficiency:** 50% of full production
- **Cost:** 40 Silver
- **Requirements:** Apprentice Overseer
- **Description:** "Competent but cautious manager. Maintains stable operations."

**Tier 3: Experienced Overseer**
- **Efficiency:** 65% of full production
- **Cost:** 100 Silver (or 1 Gold)
- **Requirements:** Junior Overseer
- **Description:** "Seasoned manager who knows the furnace well. Good efficiency."

**Tier 4: Senior Overseer**
- **Efficiency:** 80% of full production
- **Cost:** 250 Silver (or 2.5 Gold)
- **Requirements:** Experienced Overseer
- **Description:** "Veteran manager with years of experience. Near-optimal operations."

**Tier 5: Master Overseer**
- **Efficiency:** 90% of full production
- **Cost:** 6 Gold + 25 mechanisms
- **Requirements:** Senior Overseer
- **Description:** "Expert manager, one of the best in the region. Exceptional efficiency."

**Tier 6: Executive Manager**
- **Efficiency:** 98% of full production
- **Cost:** 15 Gold + 75 mechanisms + 50 components
- **Requirements:** Master Overseer
- **Description:** "Elite professional manager with formal training. Nearly matches owner's personal oversight."

---

### 2. Shift Duration Upgrades

Progressive time limit upgrades allowing longer offline periods.

**Tier 1: Trial Shift**
- **Duration:** 1 hour
- **Cost:** Included with first overseer hire
- **Description:** "Brief test shift to evaluate the overseer's capabilities."

**Tier 2: Short Shift**
- **Duration:** 2 hours
- **Cost:** 10 Silver
- **Description:** "Quick shift for short absences."

**Tier 3: Standard Shift**
- **Duration:** 4 hours
- **Cost:** 25 Silver
- **Description:** "Half-day shift for moderate absences."

**Tier 4: Extended Shift**
- **Duration:** 8 hours
- **Cost:** 60 Silver
- **Description:** "Full workday shift for daytime management."

**Tier 5: Double Shift**
- **Duration:** 12 hours
- **Cost:** 120 Silver (or 1.2 Gold)
- **Description:** "Long shift covering business hours and evening operations."

**Tier 6: Long Shift**
- **Duration:** 18 hours
- **Cost:** 250 Silver (or 2.5 Gold)
- **Description:** "Extended coverage for overnight operations."

**Tier 7: Full Day Shift**
- **Duration:** 24 hours
- **Cost:** 5 Gold + 10 mechanisms
- **Description:** "Round-the-clock management for full-day absences."

**Tier 8: Extended Day Shift**
- **Duration:** 36 hours
- **Cost:** 10 Gold + 25 mechanisms
- **Description:** "Day-and-a-half coverage for weekend trips."

**Tier 9: Two-Day Shift**
- **Duration:** 48 hours
- **Cost:** 20 Gold + 50 mechanisms + 25 components
- **Description:** "Full weekend coverage without player oversight."

**Tier 10: Three-Day Shift**
- **Duration:** 72 hours
- **Cost:** 40 Gold + 100 mechanisms + 50 components
- **Description:** "Extended multi-day management for long absences."

---

### 3. Management Style Slider (Continuous)

A fluid, continuous slider controlling how the overseer treats workers. The slider has **8 descriptive labels** but allows positioning at any point between 0% and 100%.

**What the Player SEES:**
- Single descriptive word based on slider position
- Cost modifier percentage only
- NO productivity information
- NO charisma gain information

**What is HIDDEN from the Player:**
- Production efficiency multipliers
- Charisma gain per hour
- All strategic trade-offs

**Slider Labels (8-point progression):**

| Position | Label | Cost Modifier |
|----------|-------|---------------|
| 0% | Comfortable | -20% |
| 12% | Relaxed | -17% |
| 25% | Orderly | -13% |
| 37% | Structured | -8% |
| 50% | Firm | 0% |
| 62% | Strict | -3% |
| 75% | Demanding | -6% |
| 87% | Ruthless | -9% |

**Hidden Production Multipliers:**

```gdscript
# Hidden from player - they must discover through experimentation
func get_production_multiplier(slider_percent: float) -> float:
    # 0% = 0.50x (Comfortable, workers too relaxed)
    # 30% = 0.65x (Orderly, sweet spot for charisma but lower production)
    # 50% = 0.80x (Firm, baseline)
    # 70% = 1.10x (Strict, pushing hard)
    # 100% = 1.40x (Ruthless, maximum exploitation)

    if slider_percent <= 50.0:
        # 0% to 50%: 0.5x to 0.8x
        return 0.5 + (slider_percent / 50.0) * 0.3
    else:
        # 50% to 100%: 0.8x to 1.4x
        return 0.8 + ((slider_percent - 50.0) / 50.0) * 0.6
```

**Hidden Charisma Gain Per Hour:**

```gdscript
# Completely hidden from player - no UI indication whatsoever
# Peak at ~30% (Orderly position)
func get_charisma_per_hour(slider_percent: float) -> float:
    # 0% = +0.2 charisma/hour (too lenient, workers resent laziness)
    # 30% = +1.0 charisma/hour (PEAK - firm but fair, respected leadership)
    # 50% = +0.5 charisma/hour (balanced but not optimal)
    # 70% = +0.2 charisma/hour (harsh conditions)
    # 100% = +0.0 charisma/hour (brutal, no charisma growth)

    if slider_percent <= 30.0:
        # 0% to 30%: 0.2 to 1.0 (rising to peak)
        return 0.2 + (slider_percent / 30.0) * 0.8
    elif slider_percent <= 50.0:
        # 30% to 50%: 1.0 to 0.5 (falling from peak)
        return 1.0 - ((slider_percent - 30.0) / 20.0) * 0.5
    elif slider_percent <= 70.0:
        # 50% to 70%: 0.5 to 0.2 (continuing to fall)
        return 0.5 - ((slider_percent - 50.0) / 20.0) * 0.3
    else:
        # 70% to 100%: 0.2 to 0.0 (approaching zero, never negative)
        return max(0.0, 0.2 - ((slider_percent - 70.0) / 30.0) * 0.2)
```

**Visible Cost Curve:**

```gdscript
# This IS shown to the player
func get_cost_multiplier(slider_percent: float) -> float:
    # Creates a curve: expensive at comfortable, peaks at firm, cheaper at ruthless
    # 0% = 0.8 (20% discount - comfortable conditions cost more)
    # 50% = 1.0 (full base cost)
    # 100% = 0.9 (10% discount - exploitation saves money)

    if slider_percent <= 50.0:
        # 0% to 50%: 0.8 to 1.0
        return 0.8 + (slider_percent / 50.0) * 0.2
    else:
        # 50% to 100%: 1.0 to 0.9
        return 1.0 - ((slider_percent - 50.0) / 50.0) * 0.1
```

**Label Selection:**

```gdscript
func get_management_label(slider_percent: float) -> String:
    if slider_percent < 8.0:
        return "Comfortable"
    elif slider_percent < 18.0:
        return "Relaxed"
    elif slider_percent < 31.0:
        return "Orderly"
    elif slider_percent < 43.0:
        return "Structured"
    elif slider_percent < 56.0:
        return "Firm"
    elif slider_percent < 68.0:
        return "Strict"
    elif slider_percent < 81.0:
        return "Demanding"
    else:
        return "Ruthless"
```

---

### Overseer UI Design

**Popup Window:** "Hired Overseer Management"

**Location:** Accessed from owned_furnace scene right panel button

**Layout:**
```
+─────────────────────────────────────────+
|  Hired Overseer Management          [X] |
+─────────────────────────────────────────+
| Status: Idle                             |
| (When active: Time Remaining: 17:23:45)  |
|                                          |
| ──────────── QUALITY ──────────────      |
| Current: Senior Overseer (80%)           |
| ↑ Upgrade to Master (90%)                |
|   Cost: 6 Gold + 25 mechanisms           |
|                                          |
| ──────────── DURATION ──────────────     |
| Max Shift Length: 18 hours               |
| ↑ Upgrade to Full Day (24h)              |
|   Cost: 5 Gold + 10 mechanisms           |
|                                          |
| ──────────── MANAGEMENT STYLE ────────── |
|                                          |
| [━━━━●━━━━━━━━━━━━━━━━] 25%            |
|                                          |
|         Orderly                          |
|       Cost: -13%                         |
|                                          |
| ────────────────────────────────────     |
|                                          |
| Shift Cost: 4.5 Silver/hour              |
| Total Cost: 81 Silver for 18h shift      |
|                                          |
| Set Shift Duration: [slider 1h-18h]      |
| Selected: 18 hours                       |
|                                          |
| [Start Overseer Shift]                   |
+─────────────────────────────────────────+
```

**UI Behavior:**
- Slider is **continuous** - can be positioned anywhere from 0-100%
- Word label updates fluidly as slider moves
- Cost percentage updates in real-time
- NO hints about production or charisma effects
- Shift duration slider shows only available range (based on purchased upgrades)
- Start button disabled if cannot afford total cost

---

### Cost Calculation & Payment

**Base Shift Cost Formula:**
```gdscript
# Calculate base hourly cost
var base_hourly_rate = (average_revenue_per_hour * overseer_quality_efficiency)
var cost_multiplier = get_cost_multiplier(management_slider_percent)
var hourly_cost = base_hourly_rate * cost_multiplier

# Total shift cost
var total_shift_cost = hourly_cost * shift_duration_hours
```

**Payment Timing:**
- Cost is **deducted upfront** when shift starts
- If player cannot afford full shift cost, shift cannot be started
- Any revenue earned during shift is added to player's coins
- Net result: `final_coins = starting_coins - shift_cost + revenue_earned`

**Revenue During Shift:**
```gdscript
# Offline revenue calculation (when shift completes)
var quality_efficiency = overseer_quality_percent  # 0.30 to 0.98
var style_efficiency = get_production_multiplier(management_slider_percent)  # 0.5 to 1.4
var total_efficiency = quality_efficiency * style_efficiency

# Apply to normal revenue calculation
var offline_revenue = normal_revenue * total_efficiency * hours_elapsed
```

**Charisma Accumulation:**
```gdscript
# When shift completes (completely silent, no notification)
var charisma_per_hour = get_charisma_per_hour(management_slider_percent)
var total_charisma_gain = charisma_per_hour * shift_duration_hours

Global.add_stat_exp("charisma", total_charisma_gain)
# NO notification - player must discover this through improved worker efficiency
```

---

### Integration with Existing Systems

**With Worker System:**
- Overseer manages existing hired workers (stokers, firemen, engineers)
- Worker effects continue during offline time at reduced efficiency
- Worker heat generation, decay reduction, steam efficiency all apply
- Overseer quality determines how effectively workers are utilized

**With Demand System:**
- Demand continues to fluctuate during offline time
- Overseer attempts to meet demand using available workers/steam
- Performance is tracked and affects revenue multiplier
- Critical demand spikes may cause poor performance if not prepared

**With Charisma System:**
- Charisma gains from overseer management style (hidden)
- Existing charisma bonus to worker efficiency still applies
- Creates compound effect: higher charisma → better workers → better offline gains
- Sweet spot discovery: players eventually learn ~30% slider = best long-term growth

**With Steam Storage System:**
- Storage continues to function during offline time
- Overflow storage captures excess during low demand
- Auto-release (if configured) helps manage high demand spikes
- Storage particularly valuable for longer offline periods

---

### Level1Vars Additions

```gdscript
# Hired Overseer System
var overseer_quality_tier: int = 0  # 0=none, 1=apprentice, 2=junior, ..., 6=executive
var overseer_shift_duration_tier: int = 0  # 0=none, 1=1h, 2=2h, ..., 10=72h
var overseer_management_slider: float = 50.0  # 0.0 to 100.0, continuous

# Overseer Active State
var overseer_shift_active: bool = false
var overseer_shift_start_time: int = 0  # Unix timestamp
var overseer_shift_duration: float = 0.0  # Hours selected for current shift
var overseer_shift_cost_paid: float = 0.0  # Cost deducted at start

# Overseer Unlocks
var overseer_quality_unlocked: Array[bool] = [false, false, false, false, false, false, false]  # 7 tiers (0=none)
var overseer_duration_unlocked: Array[bool] = [false, false, false, false, false, false, false, false, false, false, false]  # 11 tiers (0=none)
```

---

### Implementation Notes

**Offline Time Calculation:**

```gdscript
# In owned_furnace.gd or global offline time processor
func process_offline_overseer_time():
    if not Level1Vars.overseer_shift_active:
        return

    var current_time = Time.get_unix_time_from_system()
    var elapsed_seconds = current_time - Level1Vars.overseer_shift_start_time
    var elapsed_hours = elapsed_seconds / 3600.0

    # Cap at purchased shift duration
    var max_hours = get_shift_duration_hours(Level1Vars.overseer_shift_duration_tier)
    elapsed_hours = min(elapsed_hours, max_hours)

    if elapsed_hours >= Level1Vars.overseer_shift_duration:
        # Shift complete
        complete_overseer_shift(elapsed_hours)
    else:
        # Shift still in progress - show remaining time
        update_overseer_ui(elapsed_hours)

func complete_overseer_shift(hours_elapsed: float):
    # Calculate revenue earned
    var quality_eff = get_quality_efficiency(Level1Vars.overseer_quality_tier)
    var style_eff = get_production_multiplier(Level1Vars.overseer_management_slider)
    var total_eff = quality_eff * style_eff

    # Simulate production
    var revenue_earned = calculate_offline_revenue(hours_elapsed, total_eff)
    Level1Vars.coins += revenue_earned

    # Silently award charisma (no notification!)
    var charisma_gain = get_charisma_per_hour(Level1Vars.overseer_management_slider) * hours_elapsed
    Global.add_stat_exp("charisma", charisma_gain)

    # Reset overseer state
    Level1Vars.overseer_shift_active = false

    # Show completion summary
    show_shift_complete_popup(hours_elapsed, revenue_earned, Level1Vars.overseer_shift_cost_paid)
```

**UI Update Functions:**

```gdscript
func update_management_slider_display():
    var percent = Level1Vars.overseer_management_slider
    var label = get_management_label(percent)
    var cost_mult = get_cost_multiplier(percent)
    var cost_display = "%+.0f%%" % ((cost_mult - 1.0) * 100)

    management_label.text = label
    cost_label.text = "Cost: " + cost_display

    # Update total shift cost estimate
    update_shift_cost_estimate()
```

---

### Strategic Player Discovery Process

**Phase 1: Initial Discovery**
- Player hires first overseer, uses default 50% (Firm) slider position
- Returns to modest revenue, realizes offline progression is possible
- Experiments with slider to see cost differences

**Phase 2: Cost Optimization**
- Player discovers moving slider toward "Ruthless" reduces costs
- May operate at high efficiency (90-100%) for pure profit maximization
- Accumulates coins but misses hidden charisma gains

**Phase 3: Performance Discrepancy**
- Over time, player may notice their workers seem less efficient than other players
- Or notices their own worker efficiency varies between play sessions
- Begins to wonder if management style affects more than cost

**Phase 4: Experimentation**
- Player tries different slider positions over multiple shifts
- Eventually notices worker efficiency improvements after using "Orderly" (~30%)
- Discovers the charisma sweet spot through gameplay, not UI hints
- Realizes long-term optimization ≠ short-term profit

**Phase 5: Mastery**
- Understands the hidden trade-off: short-term revenue vs long-term worker efficiency
- Strategically chooses positions based on current needs:
  - Need coins now? Use Ruthless (100%)
  - Building for endgame? Use Orderly (~30%)
  - Balanced approach? Use Firm-Structured (40-50%)

**Design Goal:** Player never sees explicit mechanics but can discover optimal play through observation and experimentation.

---

## Implementation Steps

### Phase 1: Level1Vars Setup

Add overseer variables to Level1Vars.gd:

```gdscript
# Hired Overseer System
var overseer_quality_tier: int = 1  # 1-6 (starts with apprentice)
var overseer_shift_duration_tier: int = 1  # 1-10 (starts with 1h)
var overseer_management_slider: float = 50.0  # 0-100 (continuous)

# Active Shift State
var overseer_shift_active: bool = false
var overseer_shift_start_time: int = 0
var overseer_shift_duration: float = 0.0  # Hours selected
var overseer_shift_cost_paid: float = 0.0
```

### Phase 2: Overseer UI Popup

Create popup in owned_furnace.tscn with:
- Quality upgrade buttons (6 tiers)
- Duration upgrade buttons (10 tiers)
- Management style slider (continuous 0-100%)
- Shift duration selector
- Start/Stop buttons

### Phase 3: Offline Time Calculation

Implement offline progression when shift active:

```gdscript
func process_offline_time():
    if not Level1Vars.overseer_shift_active:
        return

    var elapsed = Time.get_unix_time_from_system() - Level1Vars.overseer_shift_start_time
    var hours = min(elapsed / 3600.0, Level1Vars.overseer_shift_duration)

    var quality_eff = get_quality_efficiency(Level1Vars.overseer_quality_tier)  # 0.30-0.98
    var style_eff = get_production_multiplier(Level1Vars.overseer_management_slider)  # 0.5-1.4 (hidden)

    var revenue = calculate_revenue(hours) * quality_eff * style_eff
    Level1Vars.current_gold += revenue

    # Silent charisma gain (hidden!)
    var charisma_gain = get_charisma_per_hour(slider) * hours
    Global.add_stat_exp("charisma", charisma_gain)

    Level1Vars.overseer_shift_active = false
```

### Phase 4: Cost Calculation

Deduct shift cost upfront, show estimated earnings.

### Phase 5: Hidden Curves

Implement hidden production/charisma multipliers (not shown in UI).

---

## Testing Scenarios

### Test 1: Overseer Purchase & Upgrade
- Purchase Quality Tier 2 (50 silver)
- Verify efficiency increases from 30% to 50%
- Purchase Duration Tier 3 (4 hour shifts)
- Verify max shift length = 4 hours

### Test 2: Management Slider Discovery
- Test slider at 0% (Comfortable): Low production, cost -20%
- Test slider at 30% (Orderly): Balanced, hidden charisma peak
- Test slider at 100% (Ruthless): High production, cost -10%
- Verify player doesn't see production/charisma values (hidden)

### Test 3: Offline Progression
- Start 8-hour shift (with Tier 4 quality, 80% efficiency)
- Set management slider to 50% (Firm)
- Close game for 8 hours
- Reload and verify:
  - Shift completed
  - Revenue earned based on efficiency
  - Charisma silently increased (no notification)

### Test 4: Cost Deduction
- Verify shift cost deducted upfront
- Cannot start shift without sufficient funds
- Cost varies with management slider position (-20% to -10%)

### Test 5: Shift Interruption
- Start 12-hour shift
- Reload game after 6 hours
- Verify shift still in progress (6h remaining)
- Wait until completion
- Verify full 12h revenue awarded

---
