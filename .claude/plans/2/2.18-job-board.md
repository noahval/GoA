# Job Board Scene

## Overview

A physical job board location where players can:
1. View unlocked jobs (discovered through gameplay/exploration)
2. Assign their protagonist to idle on a specific job when leaving the game
3. Navigate directly to job locations for active play
4. See current idle status and earnings when returning

**Location Theme**: "The Grease Pit" - a grimy maintenance corridor in the train's undercarriage where informal work gets posted on oil-stained boards. The underworld job market, not official train employment.

---

## Dependencies

- **2.x-offline-earnings.md**: Provides `OfflineEarningsManager` which handles timestamp verification and duration caps. Calls into this plan's `JobBoardManager.process_offline_session()`.
- **2.x-dishwash.md**: First job with both active and idle modes (earns Holes)

**Relationship**:
- Offline Earnings (2.17) owns: timestamp verification, 2-hour cap, welcome-back notification
- Job Board (this plan) owns: job assignment, mastery tiers, efficiency calculation, `process_offline_session()`

---

## Core Mechanics

### Idle Efficiency Progression

Each job has its own idle efficiency that improves with active play mastery:

| Mastery Level | Idle Efficiency | Description |
|---------------|-----------------|-------------|
| Novice (0) | 0.1x active rate | Just learning the job |
| Apprentice | 0.2x active rate | Getting the hang of it |
| Journeyman | 0.3x active rate | Competent worker |
| Expert | 0.4x active rate | Skilled at the work |
| Master | 0.5x active rate | Maximum idle efficiency |

**Key Design**: Active play is always at least 2x more efficient than idle. This maintains the incentive to play actively while still rewarding idle progression.

### Job States

Each job can be in one of these states:
- **Locked**: Not yet discovered (greyed out or hidden)
- **Unlocked**: Available but not currently idling
- **Active Idle**: Currently assigned for idle earnings

Only ONE job can be actively idling at a time (for the protagonist).

### Future: Hireable Workers

Eventually, players may hire additional workers who can each idle one job. This is out of scope for initial implementation but the data model should support it.

---

## Scene Design

### Visual Layout

```
+------------------------------------------+
|  THE GREASE PIT                          |
|  [Navigation Bar]                        |
+------------------------------------------+
|                                          |
|   +------------+  +------------+         |
|   | DISHWASH   |  | [LOCKED]   |         |
|   | [icon]     |  | ???        |         |
|   | 0.3x idle  |  |            |         |
|   | [Set Idle] |  |            |         |
|   | [Go There] |  |            |         |
|   +------------+  +------------+         |
|                                          |
|   +------------+  +------------+         |
|   | [LOCKED]   |  | [LOCKED]   |         |
|   | ???        |  | ???        |         |
|   +------------+  +------------+         |
|                                          |
|   Current Idle: Dishwashing (0.3x)       |
|   Estimated: 12 holes/hour               |
|                                          |
+------------------------------------------+
```

### UI Elements

1. **Job Cards**: Grid of job postings
   - Job name and icon
   - Current idle efficiency (e.g., "0.3x")
   - Mastery progress indicator
   - "Set Idle" button (if unlocked)
   - "Go There" button (navigate to active scene)
   - Locked state shows "???" or silhouette

2. **Status Panel**: Bottom area showing:
   - Currently selected idle job (if any)
   - Estimated earnings rate
   - Time until offline cap reached (from Overtime system)

3. **Navigation**: Standard scene navigation to exit

---

## Data Model

### JobData Resource

```gdscript
class_name JobData
extends Resource

@export var job_id: String  # "dishwash", "coal_sort", etc.
@export var display_name: String
@export var icon: Texture2D
@export var scene_path: String  # Path to active scene
@export var base_earnings_per_hour: float  # At 1.0x efficiency
@export var currency_type: String  # "holes", "coins", etc.
@export var mastery_thresholds: Array[int]  # XP needed for each tier
```

### JobProgressData (Saved per-player)

```gdscript
var job_progress: Dictionary = {
    "dishwash": {
        "unlocked": true,
        "mastery_xp": 1500,
        "mastery_tier": 2,  # 0-4 (Novice to Master)
        "total_active_earnings": 50000,
        "total_idle_earnings": 12000,
    },
    # ... other jobs
}

var current_idle_job: String = "dishwash"  # or "" if none
```

### Idle Efficiency Calculation

```gdscript
const MASTERY_MULTIPLIERS = [0.1, 0.2, 0.3, 0.4, 0.5]

func get_idle_efficiency(job_id: String) -> float:
    var progress = job_progress.get(job_id, {})
    var tier = progress.get("mastery_tier", 0)
    return MASTERY_MULTIPLIERS[tier]

func calculate_idle_earnings(job_id: String, seconds: int) -> int:
    var job_data = load_job_data(job_id)
    var efficiency = get_idle_efficiency(job_id)
    var hours = seconds / 3600.0
    return int(job_data.base_earnings_per_hour * efficiency * hours)
```

### process_offline_session() - Called by OfflineEarningsManager

This is the primary integration point with 2.x-offline-earnings.md:

```gdscript
# Called by OfflineEarningsManager with already-capped seconds
func process_offline_session(capped_seconds: int) -> Dictionary:
    if Level1Vars.current_idle_job == "":
        return {}  # No job assigned - empty dict signals this

    var job_id = Level1Vars.current_idle_job
    var job_data = load_job_data(job_id)
    var efficiency = get_idle_efficiency(job_id)
    var earnings = calculate_idle_earnings(job_id, capped_seconds)

    # Award currency
    Level1Vars.add_currency(job_data.currency_type, earnings)

    # Track stats
    job_progress[job_id]["total_idle_earnings"] += earnings

    return {
        "earnings": earnings,
        "currency": job_data.currency_type,
        "job_name": job_data.display_name,
        "efficiency": efficiency
    }
```

---

## Integration with Offline System

**See 2.x-offline-earnings.md for the full flow.**

Summary:
1. On game load, `OfflineEarningsManager` fetches server time and calculates capped elapsed seconds
2. It calls `JobBoardManager.process_offline_session(capped_seconds)`
3. JobBoardManager (this plan) handles all job logic and returns earnings result
4. OfflineEarningsManager displays the notification

This plan only needs to:
- Save `current_idle_job` to save file
- Implement `process_offline_session()` (see Data Model section above)

---

## Job Unlocking

Jobs are unlocked through:
1. **Story progression**: Main narrative unlocks core jobs
2. **Exploration**: Finding certain locations reveals job opportunities
3. **Prerequisites**: Some jobs require mastery in others first

Unlocking is handled by the respective job systems (e.g., dishwash scene triggers unlock when first visited). The job board just reads the unlock state.

---

## Implementation Steps

### Step 1: Data Layer

1. Create `JobData` resource class
2. Create job data files for each job (`dishwash.tres`, etc.)
3. Add `job_progress` dictionary to save system
4. Add `current_idle_job` to Level1Vars

### Step 2: Job Board Manager

1. Create `JobBoardManager` singleton
2. Implement `get_idle_efficiency(job_id)`
3. Implement `calculate_idle_earnings(job_id, seconds)`
4. Implement `process_offline_session(capped_seconds)` - called by OfflineEarningsManager
5. Implement `set_idle_job(job_id)` / `clear_idle_job()`

### Step 3: Scene UI

1. Create `job_board.tscn` scene
2. Implement job card component (reusable for grid)
3. Implement locked/unlocked/active states
4. Wire up "Set Idle" and "Go There" buttons

### Step 4: Mastery Tracking

1. Hook into job completion events (dishes washed, etc.)
2. Increment mastery XP on active play
3. Handle tier-up events (with notification)

---

## Files to Create

1. `job_board/job_data.gd` - Resource class
2. `job_board/job_board_manager.gd` - Singleton
3. `job_board/job_board.tscn` - Scene
4. `job_board/job_board.gd` - Scene script
5. `job_board/job_card.tscn` - Reusable card component
6. `job_board/job_card.gd` - Card script
7. `resources/jobs/dishwash.tres` - Dishwash job data

## Files to Modify

1. `level1/level_1_vars.gd` - Add `current_idle_job` and `job_progress`
2. `save_manager.gd` - Add job progress to save/load
3. `project.godot` - Register JobBoardManager autoload

**Note**: `offline_earnings_manager.gd` is created/owned by 2.x-offline-earnings.md and already calls into this plan's JobBoardManager.

---

## Navigation

The job board should be accessible from:
- Evening menu (primary access point)
- Scene network as a standalone location

When selecting "Go There" on a job, navigate to that job's scene.

---

## Open Questions

1. **Mastery XP formula**: How much XP per dish washed? Per coal shoveled? Need to balance across jobs.
2. **Visual style**: Oil-stained paper look? Chalk board? Need art direction.
3. **Sound**: What ambient sounds for the Grease Pit? Mechanical hums, dripping?
4. **Worker hiring**: When does this unlock? What's the cost? (Defer to future plan)

---

## Success Criteria

- [ ] Player can view all unlocked jobs on the board
- [ ] Player can assign protagonist to idle one job
- [ ] Idle earnings calculate correctly based on mastery tier
- [ ] Offline earnings show job-specific breakdown
- [ ] Mastery improves with active play
- [ ] Navigation to job scenes works from board
- [ ] Save/load preserves job progress and idle assignment
- [ ] UI clearly shows efficiency multipliers

---

## Notes

This system creates a meaningful loop:
1. **Discover** new jobs through exploration
2. **Practice** actively to improve mastery
3. **Idle** more efficiently as mastery increases
4. **Unlock** new jobs that build on previous skills

The 0.1x to 0.5x range ensures active play is always valuable (2x-10x better than idle) while still making mastery progression feel rewarding for idle earnings.
