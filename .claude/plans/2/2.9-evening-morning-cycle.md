# Evening/Morning Cycle

**Goal**: Implement the evening activities (mess hall eating, dorm sleeping) and morning wake-up that transitions players between work days.

**Success Criteria**:
- `hungry` boolean in Level1Vars set to true during pay scene
- Mess scene displays stamina bar and has "Eat Rations" button that restores stamina and sets hungry to false
- Eat Rations button visible only when hungry=true, hidden when hungry=false
- Dorm scene has "Go to Sleep" button that restores stamina, performs daily reset, and transitions to dream scene
- If player tries to sleep while hungry (and hasn't dismissed warning), show popup warning about reduced effectiveness
- Dream scene has "Wake Up" button that transitions to furnace scene
- [2.9b-daily_reset.md](2.9b-daily_reset.md) documents all variables reset at end of each day

## Overview

After a work day ends (stamina hits 0 in furnace), the player goes through the pay scene (2.8-day-end), then enters the evening phase. The evening flow is:

1. **Pay Scene** -> Sets `hungry = true` -> Navigation to Dorm
2. **Dorm Scene** -> Optional navigation to Mess Hall, or Sleep
3. **Mess Scene** (optional) -> Eat rations to restore stamina and satisfy hunger -> Return to Dorm
4. **Dorm Scene** -> Sleep button triggers daily reset and transitions to Dream
5. **Dream Scene** -> Wake button transitions to Furnace for new work day

### Key Design Principles

- Player must eat to restore stamina efficiently (stamina_restore_eating vs stamina_restore_sleeping)
- Sleeping is mandatory to advance to next day - consolidates all daily resets in one place
- Dream scene acts as buffer/transition between days (future: dream sequences, visions)
- Stamina does NOT fully restore overnight - creates resource management across days
- Penalty for skipping food is missing out on eating stamina restore, not explicit debuff

**Dependencies:**
- Requires [2.8-day-end.md](2.8-day-end.md) for pay scene implementation (already has Dorm button)
- Requires mess.tscn, dorm.tscn, dream.tscn scenes (all exist)
- Requires stamina bar display pattern from furnace.gd (lines 485-510)

**Related Documentation:**
- [2.9b-daily_reset.md](2.9b-daily_reset.md) - Complete list of all variables reset daily vs persisted

---

## Implementation Tasks

### 1. Add Variables to Level1Vars

Add hunger tracking, rage system, and stamina restore values.

**In level_1_vars.gd:**

Add variables after stamina variables (around line 8):
```gdscript
# Hunger tracking
var hungry: bool = false  # Set true at end of work day, cleared by eating
var hunger_skip: bool = false  # True if player dismissed the hungry warning popup

# Overseer rage tracking
var rage: int = 0  # Increases when coal dropped, decreases when coal delivered
var whip_count: int = 0  # Track whip count for escalating punishment

# Stamina restoration values (tuneable for balance)
var stamina_restore_eating: float = 30.0  # Stamina gained from eating in mess hall
var stamina_restore_sleeping: float = 20.0  # Stamina gained from sleeping in dorm
```

Add signal after existing signals (around line 127):
```gdscript
signal hunger_changed(is_hungry: bool)
```

**Notes:**
- `hungry` is a simple boolean - no hunger level/meter needed
- `hunger_skip` resets daily (prevents popup spam within same evening, but warns again next day)
- Signal allows future UI to react if we add visual indicator later
- Defaults to false (player starts fed on day 1)
- Stamina restore values are tuneable for balance

---

### 2. Add Hungry to Save/Load

Persist hungry state across saves.

**In level_1_vars.gd get_save_data() (around line 579):**

Add to the return dictionary:
```gdscript
# Hunger state
"hungry": hungry,
"hunger_skip": hunger_skip,
# Rage system
"rage": rage,
"whip_count": whip_count,
```

**In level_1_vars.gd load_save_data() (around line 632):**

Add after existing loads:
```gdscript
# Hunger state
hungry = data.get("hungry", false)
hunger_skip = data.get("hunger_skip", false)
# Rage system
rage = data.get("rage", 0)
whip_count = data.get("whip_count", 0)
```

---

### 3. Add Daily Reset Function to Level1Vars

Centralize all daily reset logic in Level1Vars for maintainability.

**In level_1_vars.gd:**

Add function after reset_techniques():
```gdscript
# Perform daily reset when player sleeps
# Resets stats from today's work shift, prepares for tomorrow
func perform_daily_reset():
	# Reset player level for new day
	player_level = 0
	player_exp = 0.0
	player_exp_changed.emit(player_exp, get_xp_for_next_level())

	# Reset coal tracking for new day
	coal_dropped = 0
	coal_delivered = 0

	# Reset rage system
	rage = 0
	whip_count = 0

	# Reset focus to full (mental rest from sleep)
	focus = focus_max
	focus_changed.emit(focus, focus_max)

	# Reset technique system (calls existing function)
	reset_techniques()

	# Reset hunger state for new day
	hungry = false
	hunger_skip = false
	hunger_changed.emit(false)
```

**What gets reset daily (via reset_techniques()):**
- `selected_techniques` -> {} (cleared)
- `upgrades_qty` -> 0
- `clean_streak_unlocked` -> false
- `heavy_combo_unlocked` -> false
- `clean_streak_count` -> 0
- `clean_streak_max` -> 20 (base value)
- `forgiveness_charges` -> 0
- `forgiveness_coal_counter` -> 0
- `forgiveness_threshold` -> 0
- `forgiveness_max_capacity` -> 0
- `heavy_combo_stacks` -> 0
- `heavy_combo_timer` -> 0.0
- `recent_delivery_timestamps` -> [] (cleared)

**What perform_daily_reset() adds:**
- `player_level` -> 0 (reset each day)
- `player_exp` -> 0.0 (reset each day)
- `coal_dropped` -> 0
- `coal_delivered` -> 0
- `rage` -> 0
- `whip_count` -> 0
- `focus` -> focus_max (full restore from mental rest)
- `hungry` -> false
- `hunger_skip` -> false

**What is NOT reset (persists within run):**
- `currency` - All currency types persist
- `lifetime_currency` - Tracking persists
- `stamina` - Partially restored by eating/sleeping, NOT fully reset
- `stamina_max` - Maximum persists

---

### 4. Set Hungry in Pay Scene

Modify pay scene to set hungry flag when player finishes work day.

**In pay.gd _ready() (around line 10):**

Add after `ResponsiveLayout.apply_to_scene(self)`:
```gdscript
func _ready():
	# Apply responsive layout (handles background auto-loading, font scaling)
	ResponsiveLayout.apply_to_scene(self)

	# Player is hungry after a day's work
	Level1Vars.hungry = true
	Level1Vars.hunger_changed.emit(true)

	# Calculate pay from run stats
	pay_amount = Level1Vars.calculate_pay()
	# ... rest of existing code
```

**Notes:**
- Hunger is set regardless of performance (you worked, you're hungry)
- Signal emitted for any UI that might listen

---

### 5. Add Stamina Bar to Mess Scene

Display stamina bar so player can see their current stamina before deciding to eat. Follow the same pattern as furnace.gd (lines 485-510).

**In mess.tscn:**

Add StaminaBar ProgressBar node to Menu VBoxContainer, positioned at top:
```
Menu (VBoxContainer)
  -> CurrencyDisplay (added by script)
  -> StaminaBar (ProgressBar) [NEW]
  -> ToDormButton (existing)
  -> EatRationsButton [NEW]
  -> SettingsButton (existing)
```

**StaminaBar node setup:**
- Type: ProgressBar
- Name: "StaminaBar"
- Custom minimum size: Vector2(0, 20)
- Show percentage: false
- Theme type variation: Use stamina styling from default_theme.tres (yellow-green fill)

**In mess.gd:**

Add @onready reference and signal connection (following furnace.gd pattern):
```gdscript
@onready var stamina_bar: ProgressBar = $AspectContainer/MainContainer/mainarea/Menu/StaminaBar

func _ready():
	ResponsiveLayout.apply_to_scene(self)
	connect_navigation()
	connect_settings_button()
	add_currency_display()
	connect_stamina_bar()  # NEW
	connect_eat_button()  # NEW

func connect_stamina_bar():
	# Connect to Level1Vars signal (same pattern as furnace.gd)
	Level1Vars.stamina_changed.connect(_on_stamina_changed)

	# Initialize with current values
	_on_stamina_changed(Level1Vars.stamina, Level1Vars.stamina_max)

func _on_stamina_changed(new_value: float, max_value: float):
	if stamina_bar:
		stamina_bar.max_value = max_value
		stamina_bar.value = new_value

func _exit_tree():
	# Disconnect signal to prevent accumulation on repeated visits
	if Level1Vars.stamina_changed.is_connected(_on_stamina_changed):
		Level1Vars.stamina_changed.disconnect(_on_stamina_changed)
```

---

### 6. Add Eat Rations Button to Mess Scene

Allow player to eat and restore stamina. Button hidden when not hungry.

**In mess.tscn:**

Add EatRationsButton to Menu VBoxContainer:
- Type: Button
- Name: "EatRationsButton"
- Text: "Eat Rations"
- Theme type variation: none (uses default orange Button style)
- Visible: false (will be shown by script when hungry)

**In mess.gd:**

Add button logic:
```gdscript
@onready var eat_rations_button: Button = $AspectContainer/MainContainer/mainarea/Menu/EatRationsButton

func connect_eat_button():
	if eat_rations_button:
		eat_rations_button.pressed.connect(_on_eat_rations_pressed)
		# Connect to hunger signal for visibility updates
		Level1Vars.hunger_changed.connect(_on_hunger_changed)
		# Set initial visibility based on hunger state
		_update_eat_button_visibility()

func _update_eat_button_visibility():
	# Show button only when hungry
	if eat_rations_button:
		eat_rations_button.visible = Level1Vars.hungry

func _on_hunger_changed(_is_hungry: bool):
	_update_eat_button_visibility()

func _on_eat_rations_pressed():
	if not Level1Vars.hungry:
		return  # Guard clause (shouldn't happen since button hidden)

	# Restore stamina using tuneable value
	Level1Vars.modify_stamina(Level1Vars.stamina_restore_eating)

	# Clear hunger
	Level1Vars.hungry = false
	Level1Vars.hunger_changed.emit(false)

	# Show notification
	if Global.has_method("show_notification"):
		Global.show_notification("You ate a hearty meal. +%.0f stamina" % Level1Vars.stamina_restore_eating)
```

Update _exit_tree() to also disconnect hunger signal:
```gdscript
func _exit_tree():
	if Level1Vars.stamina_changed.is_connected(_on_stamina_changed):
		Level1Vars.stamina_changed.disconnect(_on_stamina_changed)
	if Level1Vars.hunger_changed.is_connected(_on_hunger_changed):
		Level1Vars.hunger_changed.disconnect(_on_hunger_changed)
```

**Design notes:**
- Button hidden when not hungry (simpler than disabled + text change)
- Stamina restore uses Level1Vars.stamina_restore_eating for easy balance tuning
- Player must choose: use rations, or sleep hungry and recover less
- Future: rations could cost copper, or be limited per day

---

### 7. Add Sleep Button to Dorm Scene

Allow player to sleep and advance to next day. Shows warning popup if hungry.

**In dorm.tscn:**

Add SleepButton to Menu VBoxContainer (at bottom, below navigation buttons):
- Type: Button
- Name: "SleepButton"
- Text: "Go to Sleep"
- Theme type variation: "AffirmativeButton" (gold/amber - positive action)

**In dorm.gd:**

Add sleep functionality with hunger warning:
```gdscript
@onready var sleep_button: Button = $AspectContainer/MainContainer/mainarea/Menu/SleepButton
@onready var play_area: Control = $AspectContainer/MainContainer/mainarea/PlayArea

# Hungry warning popup (created programmatically)
var hunger_warning_popup: PanelContainer = null

func _ready():
	# ... existing code ...
	connect_sleep_button()

func connect_sleep_button():
	if sleep_button:
		sleep_button.pressed.connect(_on_sleep_pressed)

func _on_sleep_pressed():
	# Check if player is hungry and hasn't dismissed the warning yet
	if Level1Vars.hungry and not Level1Vars.hunger_skip:
		show_hunger_warning_popup()
		return

	# Proceed with sleep
	do_sleep()

func do_sleep():
	# Restore some stamina from rest using tuneable value
	Level1Vars.modify_stamina(Level1Vars.stamina_restore_sleeping)

	# Perform daily reset (centralized in Level1Vars)
	Level1Vars.perform_daily_reset()

	# Transition to dream scene
	Global.change_scene("res://level1/dream.tscn")

func show_hunger_warning_popup():
	# Create popup if not already created
	if hunger_warning_popup:
		hunger_warning_popup.visible = true
		return

	# Create panel container
	hunger_warning_popup = PanelContainer.new()
	hunger_warning_popup.name = "HungerWarningPopup"

	# Style the panel
	var panel_style = StyleBoxFlat.new()
	panel_style.bg_color = Color(0.15, 0.12, 0.1, 0.95)
	panel_style.border_width_left = 2
	panel_style.border_width_right = 2
	panel_style.border_width_top = 2
	panel_style.border_width_bottom = 2
	panel_style.border_color = Color(0.6, 0.4, 0.2)
	panel_style.corner_radius_top_left = 8
	panel_style.corner_radius_top_right = 8
	panel_style.corner_radius_bottom_left = 8
	panel_style.corner_radius_bottom_right = 8
	panel_style.content_margin_left = 20
	panel_style.content_margin_right = 20
	panel_style.content_margin_top = 20
	panel_style.content_margin_bottom = 20
	hunger_warning_popup.add_theme_stylebox_override("panel", panel_style)

	# Create content container
	var vbox = VBoxContainer.new()
	vbox.add_theme_constant_override("separation", 15)

	# Warning title
	var title = Label.new()
	title.text = "You're Hungry"
	title.horizontal_alignment = HORIZONTAL_ALIGNMENT_CENTER
	title.add_theme_font_size_override("font_size", 20)
	vbox.add_child(title)

	# Warning message
	var message = Label.new()
	message.text = "Going to sleep hungry means you won't\nbe as effective at shoveling tomorrow.\n\nGo to the mess hall to eat first."
	message.horizontal_alignment = HORIZONTAL_ALIGNMENT_CENTER
	message.autowrap_mode = TextServer.AUTOWRAP_WORD_SMART
	vbox.add_child(message)

	# OK button
	var ok_button = Button.new()
	ok_button.text = "OK"
	ok_button.custom_minimum_size = Vector2(100, 40)
	ok_button.pressed.connect(_on_hunger_warning_ok)

	# Center button
	var button_container = HBoxContainer.new()
	button_container.alignment = BoxContainer.ALIGNMENT_CENTER
	button_container.add_child(ok_button)
	vbox.add_child(button_container)

	hunger_warning_popup.add_child(vbox)

	# Add to play area and center it
	play_area.add_child(hunger_warning_popup)

	# Center popup in play area (defer to allow size calculation)
	await get_tree().process_frame
	hunger_warning_popup.position = (play_area.size - hunger_warning_popup.size) / 2

func _on_hunger_warning_ok():
	# Set skip flag so player can sleep if they want
	Level1Vars.hunger_skip = true

	# Hide popup
	if hunger_warning_popup:
		hunger_warning_popup.visible = false
```

**Design notes:**
- Stamina restore uses Level1Vars.stamina_restore_sleeping for easy balance tuning
- Focus fully restores (mental rest from sleep) via perform_daily_reset()
- hunger_skip flag prevents popup from showing again this evening
- hunger_skip resets daily, so player gets warned again next day if they skip food
- Daily reset is centralized in Level1Vars.perform_daily_reset()

---

### 8. Add Wake Button to Dream Scene

Allow player to wake up and start new work day.

**In dream.tscn:**

Add WakeButton to Menu VBoxContainer:
- Type: Button
- Name: "WakeButton"
- Text: "Wake Up"
- Theme type variation: "AffirmativeButton" (gold/amber - positive action)

**In dream.gd:**

Add wake functionality:
```gdscript
@onready var wake_button: Button = $AspectContainer/MainContainer/mainarea/Menu/WakeButton

func _ready():
	ResponsiveLayout.apply_to_scene(self)
	connect_settings_button()
	connect_wake_button()  # NEW

func connect_wake_button():
	if wake_button:
		wake_button.pressed.connect(_on_wake_pressed)

func _on_wake_pressed():
	# Transition to furnace scene for new work day
	Global.change_scene("res://level1/furnace.tscn")
```

**Notes:**
- Dream scene is intentionally simple - just a transition point
- Future: could add dream sequences, visions, story elements
- No additional resets here - all resets happen when going to sleep

---

### 9. Create daily_reset.md Documentation

Document all variables that reset when player sleeps.

**Create: .claude/plans/2/daily_reset.md**

See content in "Files to Create" section below.

---

## Testing Strategy

### Manual Test Criteria

**Hungry Flag:**
- [ ] Pay scene sets Level1Vars.hungry to true
- [ ] Mess scene "Eat Rations" button hidden when not hungry
- [ ] Mess scene "Eat Rations" button visible when hungry
- [ ] Eating sets hungry to false
- [ ] Button hides after eating

**Hunger Warning Popup:**
- [ ] Clicking sleep while hungry=true and hunger_skip=false shows popup
- [ ] Popup displays in play area, centered
- [ ] Popup has warning message about reduced effectiveness
- [ ] Clicking OK sets hunger_skip=true and hides popup
- [ ] After dismissing popup, clicking sleep proceeds to dream scene
- [ ] hunger_skip resets to false after daily reset

**Stamina Restoration:**
- [ ] Eating in mess hall restores Level1Vars.stamina_restore_eating stamina
- [ ] Sleeping in dorm restores Level1Vars.stamina_restore_sleeping stamina
- [ ] Stamina bar in mess scene updates in real-time
- [ ] Stamina capped at stamina_max (doesn't overflow)

**Daily Reset (Sleeping):**
- [ ] coal_dropped resets to 0
- [ ] coal_delivered resets to 0
- [ ] rage resets to 0
- [ ] whip_count resets to 0
- [ ] focus resets to focus_max
- [ ] selected_techniques cleared
- [ ] upgrades_qty resets to 0
- [ ] clean_streak_unlocked resets to false
- [ ] heavy_combo_unlocked resets to false
- [ ] clean_streak_count resets to 0
- [ ] clean_streak_max resets to 20
- [ ] forgiveness_charges resets to 0
- [ ] forgiveness_coal_counter resets to 0
- [ ] forgiveness_threshold resets to 0
- [ ] forgiveness_max_capacity resets to 0
- [ ] heavy_combo_stacks resets to 0
- [ ] heavy_combo_timer resets to 0.0
- [ ] recent_delivery_timestamps cleared
- [ ] hungry resets to false
- [ ] hunger_skip resets to false
- [ ] player_level resets to 0
- [ ] player_exp resets to 0.0

**Persistence Check (NOT reset):**
- [ ] currency persists after sleep
- [ ] stamina is NOT fully reset (only partially restored)

**Save/Load Integration:**
- [ ] hungry state saves correctly
- [ ] hungry state loads correctly
- [ ] hunger_skip state saves correctly
- [ ] hunger_skip state loads correctly
- [ ] rage saves correctly
- [ ] whip_count saves correctly

**Scene Navigation:**
- [ ] Pay scene -> Dorm button works (existing from 2.8)
- [ ] Dorm scene -> Mess button works
- [ ] Mess scene -> Dorm button works
- [ ] Dorm scene -> Sleep button transitions to Dream
- [ ] Dream scene -> Wake button transitions to Furnace
- [ ] Full loop: Furnace -> (stamina 0) -> Pay -> Dorm -> Sleep -> Dream -> Wake -> Furnace

**Signal Cleanup:**
- [ ] Visiting mess hall multiple times doesn't cause signal accumulation
- [ ] _exit_tree() properly disconnects stamina_changed signal
- [ ] _exit_tree() properly disconnects hunger_changed signal

**Edge Cases:**
- [ ] Eating when already at max stamina (should still work, stamina capped)
- [ ] Sleeping when already at max stamina (should still work)
- [ ] Multiple consecutive days (reset works each time)
- [ ] Player can skip mess hall and sleep directly (with warning first time)

---

## Files to Create

### .claude/plans/2/daily_reset.md

See [2.9b-daily_reset.md](2.9b-daily_reset.md) for the complete daily reset variable reference (source of truth).

---

## Files to Modify

- [level_1_vars.gd](../../game/v0.1/level1/level_1_vars.gd) - Add `hungry`, `hunger_skip`, `rage`, `whip_count`, stamina restore variables, signal, perform_daily_reset(), and save/load integration
- [pay.gd](../../game/v0.1/level1/pay.gd) - Set hungry flag in _ready()
- [mess.tscn](../../game/v0.1/level1/mess.tscn) - Add StaminaBar and EatRationsButton to Menu
- [mess.gd](../../game/v0.1/level1/mess.gd) - Add stamina bar display, eat button logic, signal disconnection
- [dorm.tscn](../../game/v0.1/level1/dorm.tscn) - Add SleepButton to Menu
- [dorm.gd](../../game/v0.1/level1/dorm.gd) - Add sleep button logic, hunger warning popup, call Level1Vars.perform_daily_reset()
- [dream.tscn](../../game/v0.1/level1/dream.tscn) - Add WakeButton to Menu
- [dream.gd](../../game/v0.1/level1/dream.gd) - Add wake button logic

---

## Design Values (Reference)

### Stamina Restoration
- **Eating in Mess Hall**: Level1Vars.stamina_restore_eating (default: 30.0)
- **Sleeping in Dorm**: Level1Vars.stamina_restore_sleeping (default: 20.0)
- **Total if both**: ~50 stamina (significant recovery, but not full)

### Hunger Mechanic
- **Set to true**: When pay scene loads (end of work day)
- **Set to false**: When eating rations OR when sleeping (new day)
- **Penalty for skipping food**: Missing out on 30 stamina restore (no explicit debuff)
- **Warning popup**: Shows once per evening if player tries to sleep while hungry

### Button Labels
- **Eat Button**: "Eat Rations" (hidden when not hungry)
- **Sleep Button**: "Go to Sleep"
- **Wake Button**: "Wake Up"

---

## Notes & Decisions

**Decision 1:** Stamina does NOT fully restore overnight
- **Rationale**: Creates resource management across days. Players must strategize about eating vs saving rations (future: rations could cost copper).
- **Alternatives considered**: Full stamina restore (rejected - removes strategic depth), no restore (rejected - too punishing)

**Decision 2:** Focus fully restores when sleeping
- **Rationale**: Focus represents mental state. Sleep provides mental rest. Physical fatigue (stamina) is harder to recover.
- **Alternatives considered**: Partial focus restore (rejected - complicates without adding depth)

**Decision 3:** Techniques and combos both reset daily
- **Rationale**: Each day is a fresh start for builds. Player picks new techniques each morning, creating variety and preventing optimal builds from becoming stale.
- **Design impact**: Player must re-select techniques after each sleep, encouraging experimentation

**Decision 4:** Eating clears hunger flag, sleeping also clears it
- **Rationale**: Prevents player from being stuck hungry on day 2 if they skipped eating on day 1. New day = fresh start for hunger.
- **Penalty for skipping**: Missing out on stamina_restore_eating stamina (30 by default)

**Decision 5:** Dream scene is minimal transition
- **Rationale**: Keeps implementation simple. Dream scene exists as expansion hook for future story/vision content.
- **Future expansion**: Dream sequences, NPC visions, story progression, special events

**Decision 6:** Hide eat button instead of disable with text change
- **Rationale**: Simpler UX - if you can't eat, button isn't there. No "Already Fed" state to explain.
- **Alternatives considered**: Disabled button with explanatory text (rejected - more complex, less clean)

**Decision 7:** Hunger warning popup with skip flag
- **Rationale**: Warns player once about consequences, then lets them proceed if they choose. Resets daily so new players aren't permanently annoyed.
- **Implementation**: hunger_skip=true after dismissing popup, resets in perform_daily_reset()

**Decision 8:** Daily reset centralized in Level1Vars
- **Rationale**: Single source of truth. Calls existing reset_techniques() to avoid duplication.
- **Benefit**: If technique system changes, only one place to update

---

## Implementation Checklist

**Level1Vars Updates:**
- [x] Add `hungry: bool = false` variable
- [x] Add `hunger_skip: bool = false` variable
- [x] Add `rage: int = 0` variable
- [x] Add `whip_count: int = 0` variable
- [x] Add `stamina_restore_eating: float = 30.0` variable
- [x] Add `stamina_restore_sleeping: float = 20.0` variable
- [x] Add `hunger_changed(is_hungry: bool)` signal
- [x] Add `perform_daily_reset()` function that calls reset_techniques()
- [x] Add hungry, hunger_skip, rage, whip_count to get_save_data()
- [x] Add hungry, hunger_skip, rage, whip_count to load_save_data()

**Pay Scene:**
- [x] Set `Level1Vars.hungry = true` in _ready()
- [x] Call `Level1Vars.hunger_changed.emit(true)`

**Mess Scene:**
- [x] Add StaminaBar ProgressBar to mess.tscn Menu
- [x] Add EatRationsButton to mess.tscn Menu (visible: false by default)
- [x] Add @onready reference for stamina_bar
- [x] Add @onready reference for eat_rations_button
- [x] Implement connect_stamina_bar() with signal connection
- [x] Implement _on_stamina_changed() handler
- [x] Implement connect_eat_button() with hunger signal connection
- [x] Implement _update_eat_button_visibility()
- [x] Implement _on_hunger_changed() handler
- [x] Implement _on_eat_rations_pressed() with stamina_restore_eating
- [x] Implement _exit_tree() with signal disconnection

**Dorm Scene:**
- [x] Add SleepButton to dorm.tscn Menu
- [x] Add @onready reference for sleep_button
- [x] Add @onready reference for play_area
- [x] Implement connect_sleep_button()
- [x] Implement _on_sleep_pressed() with hunger check
- [x] Implement do_sleep() with stamina restore and perform_daily_reset()
- [x] Implement show_hunger_warning_popup() with styled panel
- [x] Implement _on_hunger_warning_ok() to set hunger_skip and hide popup
- [ ] Verify transition to dream scene works

**Dream Scene:**
- [x] Add WakeButton to dream.tscn Menu
- [x] Add @onready reference for wake_button
- [x] Implement connect_wake_button()
- [x] Implement _on_wake_pressed()
- [ ] Verify transition to furnace scene works

**Documentation:**
- [x] Create .claude/plans/2/daily_reset.md

**Testing:**
- [ ] Full day cycle tested (Furnace -> Pay -> Dorm -> Mess -> Dorm -> Sleep -> Dream -> Wake -> Furnace)
- [ ] Skipping mess hall tested (Furnace -> Pay -> Dorm -> Sleep (warning) -> OK -> Sleep -> Dream)
- [ ] All daily reset variables verified
- [ ] All persistent variables verified not reset
- [ ] Save/load integration tested
- [ ] Signal cleanup verified (no accumulation on repeated visits)
- [ ] Edge cases tested

---

**Last Updated**: 2026-01-07
**Status**: Implementation complete - testing required
