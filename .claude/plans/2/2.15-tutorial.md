# Tutorial System

**Goal**: Show a one-time tutorial screen before the player's first furnace session

**Success Criteria**:
- Tutorial displays on first game load before furnace
- After clicking "OK", tutorial never shows again
- Player proceeds directly to furnace gameplay

## Overview

When the furnace scene loads, it checks if the player has completed the tutorial. If not, it redirects to the tutorial scene which displays an instructional background image. The player clicks "OK" to mark the tutorial as complete and proceed to the furnace.

The tutorial scene already exists with a background image loader. This plan adds the gating logic and dismiss button.

---

## Implementation Tasks

### 1. Add Tutorial Flag to Level1Vars

**File**: `res://level1/level_1_vars.gd`

Add a boolean variable to track tutorial completion:

```gdscript
# Tutorial tracking
var tutorial_completed: bool = false
```

**Location**: Add near the top with other tracking variables (after the debug flags section around line 95).

**Save/Load Integration**: Add to `get_save_data()` and `load_save_data()`:

```gdscript
# In get_save_data() - add to the returned dictionary:
"tutorial_completed": tutorial_completed,

# In load_save_data() - add to the loading section:
tutorial_completed = data.get("tutorial_completed", false)
```

Note: Do NOT reset this in `reset_to_defaults()` - the tutorial should only show once ever, not reset when starting a new run.

---

### 2. Add Tutorial Check to Furnace Scene

**File**: `res://level1/furnace.gd`

Add a check at the start of `_ready()` to redirect to tutorial if not completed:

```gdscript
func _ready():
    # Tutorial gate - redirect if not completed
    if not Level1Vars.tutorial_completed:
        get_tree().change_scene_to_file("res://level1/tutorial.tscn")
        return

    # ... rest of existing _ready() code ...
```

**Important**: The `return` statement prevents the rest of `_ready()` from executing, avoiding any unnecessary setup when we're just redirecting.

---

### 3. Add OK Button to Tutorial Scene

**File**: `res://level1/tutorial.tscn`

Add a Button node to the scene:
- **Parent**: `AspectContainer/MainContainer/mainarea/Menu`
- **Name**: `OkButton`
- **Text**: "OK"
- **Position**: Add as child of Menu VBoxContainer (will appear in sidebar)

The tutorial scene already inherits from scene_template.tscn which provides the Menu VBoxContainer.

---

### 4. Update Tutorial Script

**File**: `res://level1/tutorial.gd`

Update to connect the OK button and handle dismissal:

```gdscript
extends Control

func _ready():
    ResponsiveLayout.apply_to_scene(self)  # REQUIRED
    connect_settings_button()
    connect_ok_button()
    load_background()

func connect_settings_button():
    var settings_button = $AspectContainer/MainContainer/mainarea/Menu/SettingsButton
    if settings_button:
        settings_button.pressed.connect(_on_settings_pressed)

func _on_settings_pressed():
    # Store current scene for return navigation
    Global.previous_scene = scene_file_path
    Global.change_scene("res://settings.tscn")

func connect_ok_button():
    var ok_button = $AspectContainer/MainContainer/mainarea/Menu/OkButton
    if ok_button:
        ok_button.pressed.connect(_on_ok_pressed)

func _on_ok_pressed():
    # Mark tutorial as completed
    Level1Vars.tutorial_completed = true

    # Navigate to furnace
    get_tree().change_scene_to_file("res://level1/furnace.tscn")

func load_background():
    var background = $AspectContainer/MainContainer/Background
    if background:
        var texture = load("res://level1/backgrounds/tutorial.png")
        if texture:
            background.texture = texture
```

---

## Files to Modify

| File | Changes |
|------|---------|
| `res://level1/level_1_vars.gd` | Add `tutorial_completed` variable, save/load support |
| `res://level1/furnace.gd` | Add tutorial redirect check at start of `_ready()` |
| `res://level1/tutorial.tscn` | Add OkButton to Menu |
| `res://level1/tutorial.gd` | Add OK button handler, set flag, navigate to furnace |

---

## Testing Strategy

### Manual Test Criteria

- [ ] Fresh game: Tutorial shows before furnace
- [ ] Click OK: Tutorial flag set to true
- [ ] After OK: Furnace scene loads
- [ ] Subsequent loads: Furnace loads directly (no tutorial)
- [ ] Save/load: Tutorial completion persists
- [ ] OK button styled correctly (inherits from template)
- [ ] Background image displays properly

### Integration Test Scenarios

| Scenario | Setup | Action | Expected Result |
|----------|-------|--------|-----------------|
| First load | Fresh save, tutorial_completed = false | Load furnace scene | Redirects to tutorial |
| Tutorial dismiss | On tutorial scene | Click OK | Sets flag, goes to furnace |
| Subsequent load | tutorial_completed = true | Load furnace scene | Stays on furnace |
| Save persistence | Complete tutorial, save, reload | Check Level1Vars | tutorial_completed = true |

---

## Notes & Decisions

**Decision 1**: Tutorial flag persists permanently
- **Rationale**: Tutorial should only show once ever, even across save resets
- **Implementation**: Not included in `reset_to_defaults()`, only in save/load

**Decision 2**: Direct scene change instead of SceneNetwork
- **Rationale**: Tutorial is already in SYSTEM_SCENES (bypasses network validation)
- **Benefit**: Simpler implementation, no network registration needed

**Decision 3**: Check in furnace._ready() rather than main menu
- **Rationale**: User specified "when furnace scene first comes up"
- **Benefit**: Works regardless of how player reaches furnace

---

## Implementation Checklist

- [ ] `tutorial_completed` variable added to Level1Vars
- [ ] Save/load integration for tutorial_completed
- [ ] Tutorial redirect check added to furnace.gd
- [ ] OkButton added to tutorial.tscn
- [ ] OK button handler in tutorial.gd
- [ ] Manual tests passing
- [ ] Tutorial shows only once

---

**Last Updated**: 2026-01-06
