# Dishwash: Basin Particles

**Goal**: Add visual feedback when mug enters basin using particle effects

**Success Criteria**: Brown water droplets splash when mug enters basin, fall naturally with gravity

## Overview

Adds CPUParticles2D to the basin that emit brown water droplets when mug enters. Particles splash upward then fall back down naturally via gravity. Purely visual polish - no gameplay impact.

### Key Design Principles

- Particles spawn only when mug enters basin
- Brown muddy water aesthetic (fits poverty theme)
- Natural gravity pulls particles down
- No collision needed - particles fall through visually
- Performance-friendly (low particle count)

---

## Implementation Tasks

### 1. Add Particle Node

Add to Basin structure:

```
Basin (Area2D)
├── CollisionShape2D
├── WaterVisual (ColorRect)
└── WaterParticles (CPUParticles2D) # NEW
    # emitting = false (controlled by script)
```

**Implementation details:**
- CPUParticles2D added as child of Basin
- Position centered on basin
- Initially not emitting (turned on by script)

### 2. Configure Particle Properties

In Godot editor or via script, set CPUParticles2D properties:

```gdscript
# In _ready() or set in editor
var particles = $Basin/WaterParticles

# Emission control
particles.emitting = false  # Controlled by basin entry/exit
particles.amount = 20
particles.lifetime = 0.5
particles.one_shot = false
particles.explosiveness = 0.3  # Some initial burst

# Color - brown muddy water
particles.color = Color(0.4, 0.3, 0.2, 0.6)

# Emission shape - spawn along top of basin
particles.emission_shape = CPUParticles2D.EMISSION_SHAPE_RECTANGLE
particles.emission_rect_extents = Vector2(40, 5)  # Wide, shallow

# Movement - splash up then fall
particles.direction = Vector2(0, -1)  # Initial upward
particles.spread = 45.0  # Degrees of variance
particles.gravity = Vector2(0, 200)  # Pull down naturally
particles.initial_velocity_min = 30
particles.initial_velocity_max = 80

# Particle size
particles.scale_amount_min = 2.0
particles.scale_amount_max = 4.0
```

**Explanation**: Particles spawn in rectangular area, shoot upward with variance, then gravity pulls them down naturally. Brown color matches dirty water aesthetic.

### 3. Hook Up to Basin Events

Modify `dishwash_minigame.gd`:

```gdscript
func _on_basin_area_entered(area: Area2D):
	# (existing logic for mug state)
	if area == $BoundMug and mug_bound_to_cursor and current_mug_state == MugState.DIRTY:
		mug_in_basin = true
		last_mug_position = get_global_mouse_position()

		# NEW: Start particle emission
		$Basin/WaterParticles.emitting = true

func _on_basin_area_exited(area: Area2D):
	# (existing logic)
	if area == $BoundMug:
		mug_in_basin = false

		# NEW: Stop particle emission
		$Basin/WaterParticles.emitting = false
```

**Explanation**: Particles emit only while mug is in basin. Turns on when entering, off when leaving. Simple visual feedback for basin interaction.

---

## Testing Strategy

### Manual Test Criteria

- [ ] No particles visible when minigame starts
- [ ] Moving mug into basin spawns brown water particles
- [ ] Particles splash upward initially
- [ ] Particles fall back down naturally (gravity visible)
- [ ] Particles stop spawning when mug leaves basin
- [ ] Existing particles finish their lifetime after leaving (don't disappear instantly)
- [ ] Particle color matches brown muddy water theme (Color(0.4, 0.3, 0.2, 0.6))
- [ ] Particle emission doesn't cause performance issues (smooth at 60fps)
- [ ] Particles emit from top of basin area (not center of mug)

### Visual Quality Checks

- [ ] Particle count feels appropriate (not too sparse, not overwhelming)
- [ ] Splash effect looks natural (not too violent, not too subtle)
- [ ] Brown color fits game aesthetic (grimy bar work theme)
- [ ] Particle size variation provides visual interest

---

## Files to Modify

- `c:\Goa\game\v0.1\level1\bar.tscn` - Add WaterParticles node to Basin
- `c:\Goa\game\v0.1\level1\dishwash_minigame.gd` - Add particle emission control

---

## Design Values (Reference)

### Particle Configuration

- **Particle count**: 20 (amount)
- **Lifetime**: 0.5 seconds (short-lived)
- **Color**: Color(0.4, 0.3, 0.2, 0.6) - brown with some transparency
- **Emission shape**: Rectangle, 40x5 extents (wide, shallow)
- **Gravity**: Vector2(0, 200) - natural downward pull
- **Initial velocity**: 30-80 (upward splash)
- **Spread**: 45 degrees (variance in direction)
- **Explosiveness**: 0.3 (some initial burst)
- **Scale range**: 2.0 - 4.0 (size variation)

---

## Notes & Decisions

**Decision: CPUParticles2D over GPUParticles2D**
- Rationale: Simpler configuration
- Better for 2D games with modest particle counts
- Easier to preview in editor
- Performance is fine for 20 particles

**Decision: No collision on particles**
- Rationale: Purely visual effect
- Particles fall through water visual naturally
- No gameplay impact
- Simpler setup

**Decision: Emit only while in basin**
- Rationale: Tied to mug presence
- Clear cause-and-effect feedback
- Saves performance when not needed
- Particles naturally disappear after leaving (lifetime timeout)

**Decision: Brown color matching water**
- Rationale: Consistency with basin WaterVisual ColorRect
- Fits grimy poverty aesthetic
- Makes clear these are water droplets, not something else

**Decision: Rectangle emission shape**
- Rationale: Matches basin rectangular area
- Spawns across width of basin (not single point)
- More natural-looking splash
- Better coverage of basin surface

**Decision: Lifetime 0.5 seconds**
- Rationale: Short enough to avoid visual clutter
- Long enough to see particles fall
- Keeps particle count low (20 active at most)
- Performance-friendly

---

**Last Updated**: 2026-01-14
