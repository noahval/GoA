# Dishwash: Mastery Unlock

**Goal**: Unlock dishwashing mastery at 150 lifetime mugs for passive mode eligibility

**Success Criteria**: Level1Vars.dishwash_mastery_unlocked set to true at 150 mugs, only triggers once

## Overview

Checks lifetime mug counter after each mug completed. When threshold reaches 150, sets mastery flag and shows notification. One-time unlock that enables passive dishwashing mode in future systems.

### Key Design Principles

- Lifetime tracking (not session-based)
- One-time unlock (doesn't trigger repeatedly)
- Placeholder notification (proper system added later)
- Foundation for future passive mode implementation

---

## Implementation Tasks

### 1. Add Mastery Check Function

Add to `dishwash_minigame.gd`:

```gdscript
const MASTERY_THRESHOLD: int = 150  # Mugs needed for mastery

func check_mastery_unlock():
	if Level1Vars.mugs_washed >= MASTERY_THRESHOLD and not Level1Vars.dishwash_mastery_unlocked:
		Level1Vars.dishwash_mastery_unlocked = true
		print("Dishwashing mastery unlocked!")
		# TODO: Replace with Global.show_notification() when notification system exists
		# Global.show_notification("Dishwashing mastered! Passive mode unlocked.", "positive")
```

**Explanation**: Checks if threshold met and flag not already set. Sets flag once, prints notification. Placeholder for future notification system.

### 2. Call Check After Mug Completion

Update `complete_mug()`:

```gdscript
func complete_mug():
	# Increment counters (existing from 2.23)
	mugs_this_session += 1
	mugs_toward_hole += 1
	Level1Vars.mugs_washed += 1

	# Unbind mug (existing)
	unbind_mug()

	# Award Holes if batch complete (existing)
	if mugs_toward_hole >= MUGS_PER_HOLE:
		mugs_toward_hole = 0
		Level1Vars.add_currency("holes", 1.0)

	# NEW: Check for mastery unlock
	check_mastery_unlock()
```

**Explanation**: Checks mastery after every mug. Only triggers once due to flag guard.

---

## Testing Strategy

### Manual Test Criteria

- [ ] Mastery does NOT unlock before 150 mugs
- [ ] Mastery DOES unlock at exactly 150 mugs
- [ ] Print message appears: "Dishwashing mastery unlocked!"
- [ ] Level1Vars.dishwash_mastery_unlocked becomes true
- [ ] Mastery does NOT trigger again after 150th mug
- [ ] Mastery check doesn't cause performance issues (simple comparison)
- [ ] Flag persists across sessions (saved in Level1Vars)

### Test Scenario: Reach Mastery

**Fast Testing Method (Debug)**:
```gdscript
# Temporarily add to _ready() for testing:
Level1Vars.mugs_washed = 147  # Start near threshold
```

Then complete 3 mugs and verify unlock message appears on 3rd.

**Production Testing**: Complete 150 mugs naturally (long test, ~25-30 minutes at ~10s per mug).

---

## Files to Modify

- `c:\Goa\game\v0.1\level1\dishwash_minigame.gd` - Add mastery check logic

---

## Design Values (Reference)

### Mastery Parameters

- **Threshold**: 150 mugs (MASTERY_THRESHOLD)
- **Tracking variable**: Level1Vars.mugs_washed (lifetime counter)
- **Unlock flag**: Level1Vars.dishwash_mastery_unlocked (boolean)
- **Timing**: Checked after every mug completed

### Future Passive Mode (Not Implemented Yet)

- **Passive rate**: 2 Holes per minute (1 Hole every 30 seconds)
- **Activation**: Player assigns character to dishwashing (future UI)
- **Comparison**: Active play ~6-7 Holes/minute vs Passive 2 Holes/minute

---

## Notes & Decisions

**Decision: Lifetime tracking (not session-based)**
- Rationale: Mastery is permanent achievement
- Level1Vars.mugs_washed persists across sessions
- Matches "total experience" concept
- More meaningful progression

**Decision: Check after every mug (not batch)**
- Rationale: Precise 150-mug threshold
- Not "150 Holes earned" (would be 450 mugs)
- Simpler logic (no special timing)
- Negligible performance impact

**Decision: One-time unlock with flag guard**
- Rationale: Prevents spam notifications
- `and not Level1Vars.dishwash_mastery_unlocked` condition
- Clean boolean check
- Efficient (short-circuits after first unlock)

**Decision: Print instead of notification system**
- Rationale: Notification system may not exist yet
- Print works for MVP/testing
- TODO comment marks where to integrate proper notification
- Easy to replace later

**Decision: 150 mugs threshold**
- Rationale: From original plan specification
- ~25-30 minutes of active play
- Feels like meaningful achievement
- Not too grindy, not too easy

**Decision: Check in complete_mug() not _process()**
- Rationale: Only check when relevant (mug completed)
- Not every frame (wasteful)
- Clearer code organization
- More maintainable

**Decision: No partial progress notification**
- Rationale: Keeps implementation simple
- Could add "XX/150 mugs washed" display later
- Not required for MVP
- Focus on unlock event itself

**Decision: Mastery doesn't change current gameplay**
- Rationale: Just sets flag for future systems
- Active mode still works the same
- Passive mode implementation is separate plan (future)
- Clean separation of concerns

---

## Future Integration Points

When passive mode system implemented:
- UI button: "Assign to dishwashing" (disabled if not mastered)
- Tooltip: "Requires dishwashing mastery (150 mugs washed)"
- Timer: Award 1 Hole every 30 seconds while assigned
- Character: Cannot do other jobs while assigned to dishwashing

---

**Last Updated**: 2026-01-14
