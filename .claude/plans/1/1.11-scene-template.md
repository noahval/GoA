# Scene Template

**Goal**: Create minimal reusable scene template that all game scenes inherit from

**Success Criteria**:
- Scene template file created with correct node structure
- Scenes can inherit template and add custom content
- ResponsiveLayout.apply_to_scene() handles all sizing/scaling automatically

**Prerequisites**:
- Phase 1.11 (Responsive Layout Guide) - ResponsiveLayout autoload exists
- Phase 1.10 (Default Theme) - default_theme.tres exists

---

## Overview

Establishes the base scene template that ALL game scenes inherit from. Provides minimal node structure (play area, menu, notification bar) that ResponsiveLayout.apply_to_scene() automatically configures. Scenes inherit this template, rename the root node, add their content, call apply_to_scene() in _ready(), and everything just works.

### Key Design Principles

- **Minimal node structure only**: Template defines names and types, ResponsiveLayout handles everything else
- **Inheritance-based**: All scenes inherit from this template
- **Zero configuration**: All sizing/scaling/positioning handled by ResponsiveLayout (Phase 1.11)
- **Background auto-loading**: Handled by ResponsiveLayout based on scene location and root node name (see Background Auto-Loading section below)

### Level-Specific Content

This plan defines the **universal structure** (node hierarchy) that all scenes inherit. For **level-specific content** (what goes inside those nodes), see:

- **Level 1 (Copper Era)**: [../2/level1-scene-standards.md](../2/level1-scene-standards.md) - Standard UI elements, variables, and patterns for Level 1 scenes
- **Level 2**: [Future - will have its own content standards plan]

---

## Implementation Tasks

### 1. Create Scene Template File

**File**: `res://level1/scene_template.tscn`

**Node Structure**:
```
SceneRoot (Control)
├── Background (ColorRect - black letterbox background)
├── AspectContainer (AspectRatioContainer)
│   └── MainContainer (Control)
│       ├── Background (TextureRect - scene background)
│       ├── mainarea (HBoxContainer)
│       │   ├── PlayArea (Control)
│       │   └── Menu (VBoxContainer)
│       │       └── SettingsButton (Button)
│       └── NotificationBar (VBoxContainer)
```

**Node Purposes**:
- **SceneRoot**: Root node (renamed in child scenes)
- **Background**: Black ColorRect for letterbox bars outside aspect ratio
- **AspectContainer**: AspectRatioContainer maintaining 16:9 ratio (1.77778)
- **MainContainer**: Main control container inside aspect ratio
- **Background**: TextureRect for scene-specific background (auto-loaded by ResponsiveLayout)
  - TextureRect: stretch_mode = KEEP_ASPECT_COVERED (maintains aspect ratio, covers screen, crops overflow)
  - VideoStreamPlayer: expand = true (similar covered behavior for videos)
- **mainarea**: HBoxContainer for play area and menu (positioned by ResponsiveLayout)
- **PlayArea**: Left side gameplay area (sized by ResponsiveLayout)
- **Menu**: Right side menu for stats/buttons (sized by ResponsiveLayout)
  - **SettingsButton**: Standard button present in all scenes (inherits default_theme.tres from Phase 1.10)
- **NotificationBar**: Bottom area for notifications (sized by ResponsiveLayout, see Phase 1.13-notifications)

**What ResponsiveLayout.apply_to_scene() handles** (from Phase 1.11):
- All node sizing (PlayArea 66%, Menu 33%, NotificationBar height for 3 lines)
- All positioning and anchoring
- Font scaling based on resolution
- Background auto-loading (automatic, see Background Auto-Loading section below)
- Mouse filters (if needed)

**Template creation**:
- Use Godot editor to create minimal structure
- Apply default_theme.tres to SceneRoot
- Add SettingsButton to Menu with text "Settings" (inherits theme from SceneRoot)
- No need to set sizes, positions, or other properties (ResponsiveLayout does this)

### 2. Scene Inheritance Pattern

**Creating a new scene**:
1. Right-click `level1/scene_template.tscn` → "New Inherited Scene"
2. Rename root node from "SceneRoot" to unique name (e.g., "Bar", "Shop", "Furnace")
3. Add scene-specific content to `AspectContainer/MainContainer/mainarea/Menu` (stats, buttons) and `AspectContainer/MainContainer/mainarea/PlayArea` (gameplay)
4. Attach script with ResponsiveLayout.apply_to_scene() in _ready()
5. Save scene

**Scene script pattern**:
```gdscript
extends Control

func _ready():
    ResponsiveLayout.apply_to_scene(self)  # REQUIRED - handles all layout

    # Scene-specific initialization
    setup_ui()
    connect_signals()

func setup_ui():
    # Update labels, etc.
    pass
```

### 3. Where to Add Content

**Menu** (right side - `AspectContainer/MainContainer/mainarea/Menu`):
- SettingsButton (already included in template)
- Info panels (stats, currency, timers)
- Navigation buttons
- Action buttons
- Automatically stacks vertically

**PlayArea** (left side - `AspectContainer/MainContainer/mainarea/PlayArea`):
- Interactive gameplay elements
- Draggable objects
- Click targets
- Visual feedback
- Main focus of the scene

---

## Example Usage

**Example scene inheriting from template** (bar.gd):
```gdscript
extends Control

@onready var currency_label = $AspectContainer/MainContainer/mainarea/Menu/CurrencyPanel/CurrencyLabel

func _ready():
    ResponsiveLayout.apply_to_scene(self)  # Does all layout work
    update_display()

func update_display():
    currency_label.text = "Copper: %d" % Global.copper_current
```

**That's it!** ResponsiveLayout handles:
- Background loading (automatic based on scene location and root node name)
- All sizing (PlayArea 66%, Menu 33%, NotificationBar 120px scaled)
- Font scaling (25px → 37px at 1080p)
- Mouse filters
- Everything from Phase 1.11

---

## Background Auto-Loading

ResponsiveLayout automatically loads background images based on scene location and root node name. This feature requires zero configuration - just name your background file correctly and place it in the right folder.

### How It Works

**Universal Folder Detection**:
- Scene in `level1/` folder → looks in `level1/backgrounds/`
- Scene in `level2/` folder → looks in `level2/backgrounds/`
- Scene in any `[folder]/` → looks in `[folder]/backgrounds/`

**File Naming** (case-insensitive):
- Root node named "Furnace" → looks for `furnace.jpg` or `furnace.png`
- Root node named "Shop" → looks for `shop.jpg` or `shop.png`
- Checks both `.jpg` and `.png` extensions automatically

**Fallback Behavior**:
- If no background file found → shows no background (TextureRect remains empty)
- No errors, no warnings - graceful degradation

### Examples

| Scene Path | Root Node Name | Looks For | Fallback |
|------------|----------------|-----------|----------|
| `level1/furnace.tscn` | "Furnace" | `level1/backgrounds/furnace.jpg` or `furnace.png` | No background |
| `level1/shop.tscn` | "Shop" | `level1/backgrounds/shop.jpg` or `shop.png` | No background |
| `level2/bar.tscn` | "Bar" | `level2/backgrounds/bar.jpg` or `bar.png` | No background |

### Implementation Notes

- **Automatic**: Called by `ResponsiveLayout.apply_to_scene()` - no manual setup needed
- **Case-insensitive**: "Furnace", "furnace", "FURNACE" all look for `furnace.jpg`
- **Extension priority**: Checks `.jpg` first, then `.png`
- **Performance**: Uses `ResourceLoader.exists()` to avoid loading missing files

---

## Testing

**Template Structure:**
- [ ] scene_template.tscn has correct node structure (SceneRoot → Background → AspectContainer → MainContainer → mainarea + NotificationBar)
- [ ] mainarea contains PlayArea and Menu
- [ ] Menu contains SettingsButton with text "Settings"
- [ ] default_theme.tres applied to SceneRoot (SettingsButton inherits theme)

**Scene Inheritance:**
- [ ] Can inherit from template via Godot editor
- [ ] Can add content to Menu and PlayArea
- [ ] ResponsiveLayout.apply_to_scene() runs without errors
- [ ] Layout appears correct at 1280x720 and 1920x1080

---

## Files to Create

- `res://level1/scene_template.tscn` - Base template with minimal node structure

---

## Notes

**Decision**: Minimal template, ResponsiveLayout does the work
- **Rationale**: Separation of concerns - template provides structure, ResponsiveLayout provides sizing/scaling
- **Benefit**: One place to change layout behavior (ResponsiveLayout), template stays simple
- **All sizing/scaling/positioning logic**: See Phase 1.11 (Responsive Layout Guide)

**Decision**: No settings overlay, no popup container
- **Rationale**: Clean rebuild - settings will be a menu button, panels appear in PlayArea
- **Benefit**: Simpler structure, fewer nodes

---

**Last Updated**: 2025-12-03
**Maintainer**: Claude + User collaboration
